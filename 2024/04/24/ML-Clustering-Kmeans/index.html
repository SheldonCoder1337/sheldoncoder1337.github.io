<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ML-Clustering-Kmeans | 安居乐业</title>
  <meta name="keywords" content=" ML ">
  <meta name="description" content="ML-Clustering-Kmeans | 安居乐业">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="ContentFor Clustering, the following exercises are included  ML-clustering-Kmeans Exercise 1: kmeans clustering Exercise 2: kmeans clustering result analysis using silhouette analysis¶ Exercise 3: How">
<meta property="og:type" content="article">
<meta property="og:title" content="ML-Clustering-Introduction">
<meta property="og:url" content="https://sheldoncoder1337.github.io/2024/07/06/ML-Clustering-Introduction/index.html">
<meta property="og:site_name" content="安居乐业">
<meta property="og:description" content="ContentFor Clustering, the following exercises are included  ML-clustering-Kmeans Exercise 1: kmeans clustering Exercise 2: kmeans clustering result analysis using silhouette analysis¶ Exercise 3: How">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-07-06T03:29:27.000Z">
<meta property="article:modified_time" content="2024-07-06T04:35:16.196Z">
<meta property="article:author" content="Sheldon &amp; Vila">
<meta property="article:tag" content="ML">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/zenbum.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>Sheldon &amp; Vila</span>
</div>

<div class="icon">
    
        
    
        
            <a title="github"
               href="https://github.com/sheldoncoder1337"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <a title="email"
               href="mailto:862314702@qq.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="ALL">ALL
            
                <small>(21)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="Algo">
            
            Algo
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="JAVA">
            
            JAVA
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Math">
            
            Math
            <small>(4)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="ML">
            
            ML
            <small>(6)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="RISCV">
            
            RISCV
            <small>(5)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="tools">
            
            tools
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">关于</a>
        
        <a style="width: 50%"
                
                                           class="friends">友链</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="21">
<input type="hidden" id="yelog_site_word_count" value="18.5k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">ALL</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>朱朱</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>algorithm, find-the-shortest-path</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>assemble language</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>hexo</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ML</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>pattern recognition</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>RV</a>
            </li>
        
    </div>

</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        
        <a  class="ALL ML "
           href="/2024/07/06/ML-Clustering-Introduction/"
           data-tag="ML"
           data-author="sheldon" >
            <span class="post-title" title="ML-Clustering-Introduction">ML-Clustering-Introduction</span>
            <span class="post-date" title="2024-07-06 11:29:27">2024/07/06</span>
        </a>
        
        
        <a  class="ALL JAVA "
           href="/2024/07/04/JAVA-GaussDB/"
           data-tag="朱朱"
           data-author="Vila" >
            <span class="post-title" title="GaussDB">GaussDB</span>
            <span class="post-date" title="2024-07-04 17:43:25">2024/07/04</span>
        </a>
        
        
        <a  class="ALL JAVA "
           href="/2024/07/03/JAVA-Note/"
           data-tag="朱朱"
           data-author="Vila" >
            <span class="post-title" title="JavaNoteBook">JavaNoteBook</span>
            <span class="post-date" title="2024-07-03 23:15:28">2024/07/03</span>
        </a>
        
        
        <a  class="ALL RISCV "
           href="/2024/06/30/RV-%E6%B1%87%E7%BC%96%E7%BC%96%E7%A0%81%E6%A1%88%E4%BE%8B/"
           data-tag="RV"
           data-author="" >
            <span class="post-title" title="RV-汇编编码案例">RV-汇编编码案例</span>
            <span class="post-date" title="2024-06-30 23:43:05">2024/06/30</span>
        </a>
        
        
        <a  class="ALL RISCV "
           href="/2024/06/30/RV-Assemble-language/"
           data-tag="assemble language"
           data-author="" >
            <span class="post-title" title="RV-Assemble Language">RV-Assemble Language</span>
            <span class="post-date" title="2024-06-30 16:30:31">2024/06/30</span>
        </a>
        
        
        <a  class="ALL RISCV "
           href="/2024/06/29/RV-%E7%BC%96%E8%AF%91%E4%B8%8E%E9%93%BE%E6%8E%A5/"
           data-tag="RV"
           data-author="" >
            <span class="post-title" title="RV-编译与链接">RV-编译与链接</span>
            <span class="post-date" title="2024-06-29 17:34:12">2024/06/29</span>
        </a>
        
        
        <a  class="ALL RISCV "
           href="/2024/06/29/RV-pre/"
           data-tag="RV"
           data-author="" >
            <span class="post-title" title="RV-RISC-V preliminaries">RV-RISC-V preliminaries</span>
            <span class="post-date" title="2024-06-29 17:17:41">2024/06/29</span>
        </a>
        
        
        <a  class="ALL tools "
           href="/2024/06/29/Tools-WSL%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="WSL/git命令速查">WSL/git命令速查</span>
            <span class="post-date" title="2024-06-29 15:54:20">2024/06/29</span>
        </a>
        
        
        <a  class="ALL RISCV "
           href="/2024/06/25/RV-Intro/"
           data-tag="RV"
           data-author="" >
            <span class="post-title" title="RV-RISC-V Introduction">RV-RISC-V Introduction</span>
            <span class="post-date" title="2024-06-25 12:32:12">2024/06/25</span>
        </a>
        
        
        <a  class="ALL ML "
           href="/2024/06/24/ML-Neural-Network-Pipeline/"
           data-tag="ML"
           data-author="sheldon" >
            <span class="post-title" title="ML-Neural Network Pipeline">ML-Neural Network Pipeline</span>
            <span class="post-date" title="2024-06-24 16:53:43">2024/06/24</span>
        </a>
        
        
        <a  class="ALL ML "
           href="/2024/06/06/ML-Autoencoder/"
           data-tag="ML"
           data-author="sheldon" >
            <span class="post-title" title="ML-Autoencoder">ML-Autoencoder</span>
            <span class="post-date" title="2024-06-06 22:10:03">2024/06/06</span>
        </a>
        
        
        <a  class="ALL Math "
           href="/2024/05/04/PR-SVD/"
           data-tag="pattern recognition"
           data-author="" >
            <span class="post-title" title="PR-SVD">PR-SVD</span>
            <span class="post-date" title="2024-05-04 12:05:25">2024/05/04</span>
        </a>
        
        
        <a  class="ALL Math "
           href="/2024/05/04/PR-ch04-NLC/"
           data-tag="pattern recognition"
           data-author="" >
            <span class="post-title" title="PR-ch04-NLC">PR-ch04-NLC</span>
            <span class="post-date" title="2024-05-04 10:53:37">2024/05/04</span>
        </a>
        
        
        <a  class="ALL Math "
           href="/2024/05/04/PR-ch03-LC/"
           data-tag="pattern recognition"
           data-author="" >
            <span class="post-title" title="PR-ch03-LC">PR-ch03-LC</span>
            <span class="post-date" title="2024-05-04 10:53:25">2024/05/04</span>
        </a>
        
        
        <a  class="ALL Math "
           href="/2024/04/30/PR-ch02-Bayes/"
           data-tag="pattern recognition"
           data-author="" >
            <span class="post-title" title="PR-ch02-Bayes">PR-ch02-Bayes</span>
            <span class="post-date" title="2024-04-30 20:45:31">2024/04/30</span>
        </a>
        
        
        <a  class="ALL ML "
           href="/2024/04/24/ML-Clustering-Kmeans/"
           data-tag="ML"
           data-author="sheldon" >
            <span class="post-title" title="ML-Clustering-Kmeans">ML-Clustering-Kmeans</span>
            <span class="post-date" title="2024-04-24 17:36:07">2024/04/24</span>
        </a>
        
        
        <a  class="ALL Algo "
           href="/2024/04/17/Shortest-Path-%E2%85%A1/"
           data-tag="algorithm, find-the-shortest-path"
           data-author="" >
            <span class="post-title" title="Shortest Path Ⅱ">Shortest Path Ⅱ</span>
            <span class="post-date" title="2024-04-17 19:00:00">2024/04/17</span>
        </a>
        
        
        <a  class="ALL Algo "
           href="/2024/04/17/Shortest-Path-%E2%85%A0/"
           data-tag="algorithm, find-the-shortest-path"
           data-author="" >
            <span class="post-title" title="Shortest Path Ⅰ">Shortest Path Ⅰ</span>
            <span class="post-date" title="2024-04-17 11:42:38">2024/04/17</span>
        </a>
        
        
        <a  class="ALL tools "
           href="/2024/04/16/Tools-hexo-hand-book/"
           data-tag="hexo"
           data-author="" >
            <span class="post-title" title="hexo hand book">hexo hand book</span>
            <span class="post-date" title="2024-04-16 23:06:14">2024/04/16</span>
        </a>
        
        
        <a  class="ALL ML "
           href="/2024/04/10/ML-Clustering-Practice/"
           data-tag="ML"
           data-author="sheldon" >
            <span class="post-title" title="ML-Clustering-Practice">ML-Clustering-Practice</span>
            <span class="post-date" title="2024-04-10 22:22:21">2024/04/10</span>
        </a>
        
        
        <a  class="ALL ML "
           href="/2024/04/01/ML-Introduction/"
           data-tag="ML"
           data-author="sheldon" >
            <span class="post-title" title="ML-Introduction">ML-Introduction</span>
            <span class="post-date" title="2024-04-01 13:25:25">2024/04/01</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-ML-Clustering-Kmeans" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">ML-Clustering-Kmeans</h1>
    
    <div class="article-meta">
        
        
        <span class="author"><a>sheldon</a></span>
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="ML">ML</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color3">ML</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2024-07-07 00:13:23'>2024-04-24 17:36</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:2k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction"><span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-First-things-first"><span class="toc-text">1.1 First things first</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Calculate-distances-to-centroids"><span class="toc-text">1.2 Calculate distances to centroids</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-Attach-instances-or-rows-to-the-closest-centroid"><span class="toc-text">1.3 Attach instances or rows to the closest centroid</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-Update-centroids"><span class="toc-text">1.4 Update centroids</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Note"><span class="toc-text">Note</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-Repeat-the-above-steps"><span class="toc-text">1.5 Repeat the above steps</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In this notebook, we shall be looking at how the kmeans algorithm works. KMeans is an <strong>unsupervised learning</strong> algorithm that is used to cluster data in groups - without knowing which group given data elements belong to as are going to see.</p>
<pre><code class="python">import numpy as np
import sklearn.datasets
import matplotlib.pyplot as plt
import matplotlib as mpl
</code></pre>
<p>Let’s shall generate a random dataset of 1000 points clustered into 3 groups.</p>
<pre><code class="python"># 设置数据集中样本点的数量
N = 1000

# 生成具有3个中心点的聚类数据集
X_, y_ = sklearn.datasets.make_blobs(n_samples=N+5, centers=3) 

# 从生成的数据集中提取前N个样本作为训练数据
X, y = X_[:N], y_[:N]

# 从生成的数据集中提取后面5个样本作为测试数据
X_test, y_test = X_[N:], y_[N:]

# 绘制数据集的散点图
plt.figure(figsize=(8, 6))
for cls in np.unique(y):
    plt.scatter(X[y==cls][:, 0], X[y==cls][:, 1], s=2)
plt.title(&quot;Plot of features of dataset X&quot;, fontsize=14)
plt.xlabel(&quot;x1&quot;, fontsize=12)
plt.ylabel(&quot;x2&quot;, fontsize=12)
plt.show()
</code></pre>
<!-- ![sampla dataset](./Kmeans/sample_dataset_X.png) -->

<img src="/2024/04/24/ML-Clustering-Kmeans/sample_dataset_X.png" class>

<h2 id="1-1-First-things-first"><a href="#1-1-First-things-first" class="headerlink" title="1.1 First things first"></a>1.1 First things first</h2><ol>
<li><p>We need to determine and set a value k, the number of clusters we <strong>think</strong> the data has. KMeans is unsupervised. So it is not the case that you will always know how many clusters (k) exist in the data. You will have to experiment with different values using certain techniques to find the best value of k. For our case, we know that there are 3 clusters, therefore we shall set k to 3. (You can try a different value after the points get clear).</p>
</li>
<li><p>We also need to <strong>find k&#x3D;3 random points</strong> that will represent the centers of our clusters if the clustering is successfull. These k random points are called centroids.Let’s work on these two steps next.</p>
</li>
</ol>
<pre><code class="python">k = 3
N, feature_size = X.shape

# 获取特征的最大值和最小值范围
min_feature_range = np.min(X, axis=0)
max_feature_range = np.max(X, axis=0)

# 在上述范围内生成k个随机点
centroids = np.zeros((len(max_feature_range), k))

for i, (l, h) in enumerate(zip(min_feature_range, max_feature_range)):
    # 使用random.uniform()函数从均匀分布中抽取样本
    centroids[i, :] = np.random.uniform(low=l, high=h, size=k)

# 转置centroids矩阵，使得每行表示一个聚类中心
centroids = centroids.T
print(centroids)

# 绘制数据集的散点图和聚类中心
plt.figure(figsize=(8, 6))
for cls in np.unique(y):
    plt.scatter(X[y==cls][:, 0], X[y==cls][:, 1], s=2)

# 绘制聚类中心
for i, (x_, y_) in enumerate(centroids):
    plt.scatter(x_, y_, marker=&#39;x&#39;, c=&#39;k&#39;)
    plt.annotate(xy=(x_+.1, y_-.1), text=&#39;c&#39;+str(i), color=&#39;r&#39;)
plt.title(&quot;Plot of features of dataset X&quot;, fontsize=14)
plt.xlabel(&quot;x1&quot;, fontsize=12)
plt.ylabel(&quot;x2&quot;, fontsize=12)
plt.show()
</code></pre>
<!-- ![1.1](./Kmeans/1.1.png) -->

<img src="/2024/04/24/ML-Clustering-Kmeans/1.1.png" class>

<p>The points are scattered and may not be close to the cluster centers. There are other methods like the <strong>kmeans++</strong>.</p>
<h2 id="1-2-Calculate-distances-to-centroids"><a href="#1-2-Calculate-distances-to-centroids" class="headerlink" title="1.2 Calculate distances to centroids"></a>1.2 Calculate distances to centroids</h2><p>In this notebook, we shall be calculating the euclidean distance. We have 2 columns in X <em>(x1 and x2)</em> and we have to calculate the euclidean distance between each centroid and every data point in X. Centroids are of the form <em>(xx, yy)</em> i.e they have two points just like our dataset X has 2 columns.</p>
<p>计算每个质心和 X 中每个数据点之间的欧几里得距离。</p>
<p>We want to calculate something of the form $sqrt((x1-xx)^2 + (x2-yy)^2)$ for each data point&#x2F;row in X.<br>To accelerate operations, we shall be using a vectorized approach to calculate that.</p>
<p>使用矢量化方法来计算。</p>
<ol>
<li>We have k&#x3D;3 centroids, so we shall first duplicate <strong>X</strong> 3 times or k times. The shape of X is (1000, 2). The result of the duplication, <strong>Xc</strong> will be (1000, 6).</li>
<li>Then we shall flatten the centroids so that its a single vector, <strong>centroidsc</strong> of 6 elements to match our 6 columns in <strong>Xc</strong>.</li>
<li>We shall subtract <strong>Xc</strong> and <strong>centroidsc</strong> to give us a result <strong>D</strong> of shape (1000, 6). This step is equivalent to performing <strong>(x1-xx)</strong> and <strong>(x2-yy)</strong> for all centroids at once.</li>
</ol>
<ul>
<li>The first column of <strong>D</strong> corresponds to <strong>(x1-xx)</strong> where xx is the x of the first centroid.</li>
<li>The second column of <strong>D</strong> corresponds to <strong>(x2-yy)</strong> where yy is the y of the first centroid.</li>
<li>The third column of <strong>D</strong> corresponds to <strong>(x1-xx)</strong> where xx is the x of the <em>second</em> centroid.</li>
<li>The forth column of <strong>D</strong> corresponds to <strong>(x2-yy)</strong> where yy is the y of the <em>second</em> centroid. And so on.</li>
</ul>
<p>4.The next step is to square these results, add them and apply sqrt. This whole operation results in what is called the <em>L2 norm</em> and is all performed by the <strong>np.linalg.norm</strong> function.</p>
<p>Note that we have to calculate the norm over a given set of columns e.g the first and second columns’ norm corresponds to the first centroid, the third and forth to the 2nd centroid and the last 2 to the 3rd centroid. So in the end we have a (1000, 3) array containing euclidean distances of each of the 1000 data rows&#x2F;points in X in correspondence to each of the 3 centroids.</p>
<pre><code class="python">Xc = np.concatenate([X for c in centroids], axis=1) # duplicate X k times
centroidsc = centroids.ravel() # ravel to allow broadcast; Return a contiguous flattened array.
D = (Xc - centroidsc) # raw diff

Norms = np.zeros((N, k)) # distances to each centroid
for i in range(0, k): 
    m = i*feature_size
    Norms[:, i] = np.linalg.norm(D[:, m:m+feature_size], axis=1) # Calculating the norms (Euclidean distance)
</code></pre>
<h2 id="1-3-Attach-instances-or-rows-to-the-closest-centroid"><a href="#1-3-Attach-instances-or-rows-to-the-closest-centroid" class="headerlink" title="1.3 Attach instances or rows to the closest centroid"></a>1.3 Attach instances or rows to the closest centroid</h2><p>We shall now assign each data row in X the index of the centroid with which it has the shortest distance. We do that using <strong>np.argmin</strong> which returns the index of the minimum distance in our <em>Norms</em> array.</p>
<p>使用 <strong>np.argmin</strong> 来为 X 中的每个数据行分配与其距离最短的质心的索引，它返回 <em>Norms</em> 数组中最小距离的索引。</p>
<pre><code class="python"># sample of indices for smallest indices for sample_norms
np.argmin(sample_norms, axis=1)
# we do this for all Norms
ypred = np.argmin(Norms, axis=1) #Returns the indices of the minimum values along an axis.
plt.figure(figsize=(8, 6))
for i, (x_, y_) in enumerate(centroids):  # with underscore
    p = plt.scatter(X[y==i][:, 0], X[y==i][:, 1], s=2)
    clr = mpl.colors.to_rgba(p.get_facecolor()) # get color used by matplotlib
    plt.scatter(x_, y_, marker=&#39;x&#39;, c=&#39;k&#39;)
    anot = &#39;c&#39;+str(i) + &quot; at &quot; + str(np.round(Norms[0, i], 3))
    plt.plot([X[0][0], x_], [X[0][1], y_])
    plt.annotate(xy=(x_+.2, y_-.1), text=anot, color=&#39;k&#39;, size=10)
    
plt.scatter(X[0][0], X[0][1], marker=&#39;o&#39;, c=&#39;r&#39;, s=35)

plt.title(&quot;Plot showing distance sample (point belongs to c&quot;+str(ypred[0])+&quot;)&quot;, fontsize=14)
plt.xlabel(&quot;x1&quot;, fontsize=12)
plt.ylabel(&quot;x2&quot;, fontsize=12)

plt.show()
</code></pre>
<!-- ![1.3](./Kmeans/1.3.png) -->

<img src="/2024/04/24/ML-Clustering-Kmeans/1.3.png" class>

<h2 id="1-4-Update-centroids"><a href="#1-4-Update-centroids" class="headerlink" title="1.4 Update centroids"></a>1.4 Update centroids</h2><p>The last step is to update the centroids by setting the new centroids at the mean positions of the points they were closest to i.e the data points they influence.</p>
<p>Below is a plot showing the un-updated centroids and their influence on the data points. We shall have to move the centroids so that they are at the center of the points they influence.</p>
<pre><code class="python">plt.figure(figsize=(8, 6))
for i, (x_, y_) in enumerate(centroids):
    p = plt.scatter(X[ypred==i][:, 0], X[ypred==i][:, 1], s=2)
    clr = mpl.colors.to_rgba(p.get_facecolor()) # get color used by matplotlib
    plt.scatter(x_, y_, marker=&#39;x&#39;, c=&#39;k&#39;)
    plt.annotate(xy=(x_+.1, y_-.1), text=&#39;c&#39;+str(i), color=clr, size=14)
plt.title(&quot;Plot showing influence of recent centroids on data points&quot;, fontsize=14)
plt.xlabel(&quot;x1&quot;, fontsize=12)
plt.ylabel(&quot;x2&quot;, fontsize=12)
plt.show()
</code></pre>
<!-- ![1.4.1](./Kmeans/1.4.1.png) -->

<img src="/2024/04/24/ML-Clustering-Kmeans/1.4.1.png" class>

<ul>
<li>To do that, we shall calculate the mean of the data points each centroid influences and put the centroid at that mean location.</li>
<li>If a centroid has no points it influences (yes, this can happen), we leave the centroid where it is.</li>
</ul>
<pre><code class="python">centroids_ = []
for i in range(k):
    if len(X[ypred == i]) == 0:
        centroids_.append(centroids[i]) # use old
    else:
        centroids_.append(np.mean(X[ypred == i], axis=0))
centroids_ = np.array(centroids_)
centroids_

#After the update, we have the following plot
plt.figure(figsize=(8, 6))
for i, (x_, y_) in enumerate(centroids_):  # with underscore
    p = plt.scatter(X[ypred==i][:, 0], X[ypred==i][:, 1], s=2)
    clr = mpl.colors.to_rgba(p.get_facecolor()) # get color used by matplotlib
    plt.scatter(x_, y_, marker=&#39;x&#39;, c=&#39;k&#39;)
    plt.annotate(xy=(x_+.1, y_-.1), text=&#39;c&#39;+str(i), color=clr, size=14)
plt.title(&quot;Plot showing mean-centered centroids &quot;, fontsize=14)
plt.xlabel(&quot;x1&quot;, fontsize=12)
plt.ylabel(&quot;x2&quot;, fontsize=12)

plt.show()
</code></pre>
<img src="/2024/04/24/ML-Clustering-Kmeans/1.4.2.png" class>

<h2 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h2><ul>
<li>The mean-centered points may look good, however the data they influence may still be bad</li>
</ul>
<h2 id="1-5-Repeat-the-above-steps"><a href="#1-5-Repeat-the-above-steps" class="headerlink" title="1.5 Repeat the above steps"></a>1.5 Repeat the above steps</h2><ul>
<li>Now we repeat the steps above until the centroids don’t update or move (significantly) anymore. That will be the case when <strong>(centroids_ - centroids)^2</strong> is a low value below a certain threshold. A good threshold has to be as low as possible i.e close to or equal to zero.</li>
<li>You can run the following code multiple times and observe <strong>shift</strong> value (which is <strong>changes of centroids</strong> ) carefully</li>
<li>Here, we are using <strong>^2</strong> to make larger shifts&#x2F;updates significant. It doesn’t have to be that way. A norm can also work.</li>
</ul>
<pre><code class="python">shift = np.sum((centroids_ - centroids)**2)
print(shift)
# Below we repeat all the previous steps in one run
centroids = centroids_
Xc = np.concatenate([X for c in centroids], axis=1) # duplicate k times
centroidsc = centroids.ravel() # ravel to allow broadcast
D = (Xc - centroidsc) # raw diff

Norms = np.zeros((N, k)) # distances to each cluster
for i in range(0, k):
    m = i*feature_size
    Norms[:, i] = np.linalg.norm(D[:, m:m+feature_size], axis=1)

# Choose the nearest cluster for every point, and save the result in ypred which is used in next code segment
# We can use np.argmin function
ypred = np.argmin(Norms, axis=1) 

# new clusters are mean X along 
centroids_ = []
for i in range(k):
    if len(X[ypred == i]) == 0:
        centroids_.append(centroids[i]) # use old
    else:
        centroids_.append(np.mean(X[ypred == i], axis=0))
centroids_ = np.array(centroids_)
centroids_

plt.figure(figsize=(8, 6))
for i, (x_, y_) in enumerate(centroids_):  # with underscore
    p = plt.scatter(X[ypred==i][:, 0], X[ypred==i][:, 1], s=2)
    clr = mpl.colors.to_rgba(p.get_facecolor()) # get color used by matplotlib
    plt.scatter(x_, y_, marker=&#39;x&#39;, c=&#39;k&#39;)
    plt.annotate(xy=(x_+.1, y_-.1), text=&#39;c&#39;+str(i), color=clr, size=14)
plt.title(&quot;Plot showing mean-centered centroids &quot;, fontsize=14)
plt.xlabel(&quot;x1&quot;, fontsize=12)
plt.ylabel(&quot;x2&quot;, fontsize=12)

plt.show()
</code></pre>
<img src="/2024/04/24/ML-Clustering-Kmeans/1.5.png" class>

      
       <hr><span style="font-style: italic;color: gray;"> Please cite the source for reprints, feel free to verify the sources cited in the article, and feel free to point out any errors or lack of clarity of expression. You can comment in the comments section below or email to 862314702@qq.com 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 862314702@qq.com </span>
    </div>
</article>



<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>ML-Clustering-Kmeans</p>
    <p><span class="copy-title">字数:</span><span class="post-count">2k</span></p>
    <p><span class="copy-title">本文作者:</span><a  title="Sheldon &amp; Vila">Sheldon &amp; Vila</a></p>
    <p><span class="copy-title">发布时间:</span>2024-04-24, 17:36:07</p>
    <p><span class="copy-title">最后更新:</span>2024-07-07, 00:13:23</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2024/04/24/ML-Clustering-Kmeans/" title="ML-Clustering-Kmeans">https://sheldoncoder1337.github.io/2024/04/24/ML-Clustering-Kmeans/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">&#34;署名-非商用-相同方式共享 4.0&#34;</a> 转载请保留原文链接及作者。
    </p>
</div>



    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: '4f33aa329333316d7b3e',
            clientSecret: 'b042f64bfd07ed32f8bb8c729eb6c2973e48f58d',
            repo: 'sheldoncoder1337.github.io',
            owner: 'sheldoncoder1337',
            admin: ['sheldoncoder1337'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="//cdn.jsdelivr.net/npm/mathjax@2.7.8/unpacked/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<input type="hidden" id="MathJax-js"
        value="//cdn.jsdelivr.net/npm/mathjax@2.7.8/unpacked/MathJax.js?config=TeX-MML-AM_CHTML">
</input>
    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2024 sheldoncoder1337
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
        /* 渲染*/
        function HTMLDecode(text) {
            var temp = document.createElement("div");
            temp.innerHTML = text;
            var output = temp.innerText || temp.textContent;
            temp = null;
            return output;
        }
        if (window.mermaid){
            window.mermaid = null
        }
        $.getScript("//cdn.jsdelivr.net/npm/mermaid@8.4.2/dist/mermaid.min.js", function () {
            var mermaidOptions = JSON.parse(HTMLDecode("{&#34;theme&#34;:&#34;default&#34;,&#34;startOnLoad&#34;:true,&#34;flowchart&#34;:{&#34;useMaxWidth&#34;:false,&#34;htmlLabels&#34;:true}}"))
            if (window.mermaid) {
                mermaid.initialize(mermaidOptions)
                mermaid.contentLoaded()
            }
        })
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>






</html>
