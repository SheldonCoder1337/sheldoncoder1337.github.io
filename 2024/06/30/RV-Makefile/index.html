<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>RV-Makefile | 安居乐业</title>
  <meta name="keywords" content=" RV ">
  <meta name="description" content="RV-Makefile | 安居乐业">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="# Hardware Requirements CPU ≥ 8 cores; RAM ≥ 32 GB; Disk ≥ 100 GB;  # System Requirements macOS User：macOS Monterey 12.6 or later Linux User：CentOS 7 &#x2F; Ubuntu 20.04 or later Windows User：Windows 10 LT">
<meta property="og:type" content="article">
<meta property="og:title" content="LLM-init">
<meta property="og:url" content="https://sheldoncoder1337.github.io/2025/01/20/LLM-init/index.html">
<meta property="og:site_name" content="安居乐业">
<meta property="og:description" content="# Hardware Requirements CPU ≥ 8 cores; RAM ≥ 32 GB; Disk ≥ 100 GB;  # System Requirements macOS User：macOS Monterey 12.6 or later Linux User：CentOS 7 &#x2F; Ubuntu 20.04 or later Windows User：Windows 10 LT">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-01-20T09:47:40.000Z">
<meta property="article:modified_time" content="2025-01-28T07:47:43.454Z">
<meta property="article:author" content="Sheldon &amp; Vila">
<meta property="article:tag" content="LLM">
<meta property="article:tag" content="Data Science">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/zenbum.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>Sheldon &amp; Vila</span>
</div>

<div class="icon">
    
        
    
        
            <a title="github"
               href="https://github.com/sheldoncoder1337"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <a title="email"
               href="mailto:862314702@qq.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="ALL">ALL
            
                <small>(29)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="Algo">
            
            Algo
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="DA">
            
            DA
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="DB">
            
            DB
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="JAVA">
            
            JAVA
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="LLM">
            
            LLM
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Math">
            
            Math
            <small>(4)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="ML">
            
            ML
            <small>(6)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="READ">
            
            READ
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="RISCV">
            
            RISCV
            <small>(7)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="SE">
            
            SE
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="tools">
            
            tools
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="29">
<input type="hidden" id="yelog_site_word_count" value="24.8k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">ALL</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>朱朱</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>algorithm, find-the-shortest-path</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>assemble language</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Big Data</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Data Science</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Data structure & Algorithm</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Database System</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Distribution</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>hexo</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>LLM</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ML</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Object Oriented</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>pattern recognition</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>RV</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Software Engineering</a>
            </li>
        
    </div>

</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        
        <a  class="ALL LLM "
           href="/2025/01/20/LLM-init/"
           data-tag="LLM,Data Science"
           data-author="sheldon" >
            <span class="post-title" title="LLM-init">LLM-init</span>
            <span class="post-date" title="2025-01-20 17:47:40">2025/01/20</span>
        </a>
        
        
        <a  class="ALL READ "
           href="/2024/07/28/READ-Telemetry/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="READ-Telemetry">READ-Telemetry</span>
            <span class="post-date" title="2024-07-28 11:33:05">2024/07/28</span>
        </a>
        
        
        <a  class="ALL RISCV "
           href="/2024/07/12/RV-Arithmetic-practice/"
           data-tag="RV"
           data-author="" >
            <span class="post-title" title="RV-practice">RV-practice</span>
            <span class="post-date" title="2024-07-12 22:30:05">2024/07/12</span>
        </a>
        
        
        <a  class="ALL RISCV "
           href="/2024/07/12/RV-Arithmetic-Ins/"
           data-tag="RV"
           data-author="" >
            <span class="post-title" title="RV-Arithmetic-Instructions">RV-Arithmetic-Instructions</span>
            <span class="post-date" title="2024-07-12 10:30:05">2024/07/12</span>
        </a>
        
        
        <a  class="ALL DB "
           href="/2024/07/08/DB-Cache/"
           data-tag="Distribution,Big Data"
           data-author="sheldon" >
            <span class="post-title" title="DB-Cache">DB-Cache</span>
            <span class="post-date" title="2024-07-08 17:47:40">2024/07/08</span>
        </a>
        
        
        <a  class="ALL SE "
           href="/2024/07/08/SE-OOD/"
           data-tag="Software Engineering,Object Oriented"
           data-author="sheldon" >
            <span class="post-title" title="SE-OOD">SE-OOD</span>
            <span class="post-date" title="2024-07-08 17:28:44">2024/07/08</span>
        </a>
        
        
        <a  class="ALL DB "
           href="/2024/07/08/DB-NormalForms/"
           data-tag="Database System"
           data-author="sheldon" >
            <span class="post-title" title="DB-NormalForms">DB-NormalForms</span>
            <span class="post-date" title="2024-07-08 17:25:00">2024/07/08</span>
        </a>
        
        
        <a  class="ALL ML "
           href="/2024/07/06/ML-Clustering-Introduction/"
           data-tag="ML"
           data-author="sheldon" >
            <span class="post-title" title="ML-Clustering-Introduction">ML-Clustering-Introduction</span>
            <span class="post-date" title="2024-07-06 11:29:27">2024/07/06</span>
        </a>
        
        
        <a  class="ALL JAVA "
           href="/2024/07/04/JAVA-GaussDB/"
           data-tag="朱朱"
           data-author="Vila" >
            <span class="post-title" title="GaussDB">GaussDB</span>
            <span class="post-date" title="2024-07-04 17:43:25">2024/07/04</span>
        </a>
        
        
        <a  class="ALL JAVA "
           href="/2024/07/03/JAVA-Note/"
           data-tag="朱朱"
           data-author="Vila" >
            <span class="post-title" title="JavaNoteBook">JavaNoteBook</span>
            <span class="post-date" title="2024-07-03 23:15:28">2024/07/03</span>
        </a>
        
        
        <a  class="ALL RISCV "
           href="/2024/06/30/RV-Makefile/"
           data-tag="RV"
           data-author="" >
            <span class="post-title" title="RV-Makefile">RV-Makefile</span>
            <span class="post-date" title="2024-06-30 23:43:05">2024/06/30</span>
        </a>
        
        
        <a  class="ALL RISCV "
           href="/2024/06/30/RV-Assemble-language/"
           data-tag="assemble language"
           data-author="" >
            <span class="post-title" title="RV-Assemble Language">RV-Assemble Language</span>
            <span class="post-date" title="2024-06-30 16:30:31">2024/06/30</span>
        </a>
        
        
        <a  class="ALL RISCV "
           href="/2024/06/29/RV-%E7%BC%96%E8%AF%91%E4%B8%8E%E9%93%BE%E6%8E%A5/"
           data-tag="RV"
           data-author="" >
            <span class="post-title" title="RV-编译与链接">RV-编译与链接</span>
            <span class="post-date" title="2024-06-29 17:34:12">2024/06/29</span>
        </a>
        
        
        <a  class="ALL RISCV "
           href="/2024/06/29/RV-pre/"
           data-tag="RV"
           data-author="" >
            <span class="post-title" title="RV-RISC-V preliminaries">RV-RISC-V preliminaries</span>
            <span class="post-date" title="2024-06-29 17:17:41">2024/06/29</span>
        </a>
        
        
        <a  class="ALL tools "
           href="/2024/06/29/Tools-WSL%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="WSL/git命令速查">WSL/git命令速查</span>
            <span class="post-date" title="2024-06-29 15:54:20">2024/06/29</span>
        </a>
        
        
        <a  class="ALL RISCV "
           href="/2024/06/25/RV-Intro/"
           data-tag="RV"
           data-author="" >
            <span class="post-title" title="RV-RISC-V Introduction">RV-RISC-V Introduction</span>
            <span class="post-date" title="2024-06-25 12:32:12">2024/06/25</span>
        </a>
        
        
        <a  class="ALL ML "
           href="/2024/06/24/ML-Neural-Network-Pipeline/"
           data-tag="ML"
           data-author="sheldon" >
            <span class="post-title" title="ML-Neural Network Pipeline">ML-Neural Network Pipeline</span>
            <span class="post-date" title="2024-06-24 16:53:43">2024/06/24</span>
        </a>
        
        
        <a  class="ALL ML "
           href="/2024/06/06/ML-Autoencoder/"
           data-tag="ML"
           data-author="sheldon" >
            <span class="post-title" title="ML-Autoencoder">ML-Autoencoder</span>
            <span class="post-date" title="2024-06-06 22:10:03">2024/06/06</span>
        </a>
        
        
        <a  class="ALL Math "
           href="/2024/05/04/PR-SVD/"
           data-tag="pattern recognition"
           data-author="" >
            <span class="post-title" title="PR-SVD">PR-SVD</span>
            <span class="post-date" title="2024-05-04 12:05:25">2024/05/04</span>
        </a>
        
        
        <a  class="ALL Math "
           href="/2024/05/04/PR-ch04-NLC/"
           data-tag="pattern recognition"
           data-author="" >
            <span class="post-title" title="PR-ch04-NLC">PR-ch04-NLC</span>
            <span class="post-date" title="2024-05-04 10:53:37">2024/05/04</span>
        </a>
        
        
        <a  class="ALL Math "
           href="/2024/05/04/PR-ch03-LC/"
           data-tag="pattern recognition"
           data-author="" >
            <span class="post-title" title="PR-ch03-LC">PR-ch03-LC</span>
            <span class="post-date" title="2024-05-04 10:53:25">2024/05/04</span>
        </a>
        
        
        <a  class="ALL Math "
           href="/2024/04/30/PR-ch02-Bayes/"
           data-tag="pattern recognition"
           data-author="" >
            <span class="post-title" title="PR-ch02-Bayes">PR-ch02-Bayes</span>
            <span class="post-date" title="2024-04-30 20:45:31">2024/04/30</span>
        </a>
        
        
        <a  class="ALL ML "
           href="/2024/04/24/ML-Clustering-Kmeans/"
           data-tag="ML"
           data-author="sheldon" >
            <span class="post-title" title="ML-Clustering-Kmeans">ML-Clustering-Kmeans</span>
            <span class="post-date" title="2024-04-24 17:36:07">2024/04/24</span>
        </a>
        
        
        <a  class="ALL Algo "
           href="/2024/04/17/Shortest-Path-%E2%85%A1/"
           data-tag="algorithm, find-the-shortest-path"
           data-author="" >
            <span class="post-title" title="Shortest Path Ⅱ">Shortest Path Ⅱ</span>
            <span class="post-date" title="2024-04-17 19:00:00">2024/04/17</span>
        </a>
        
        
        <a  class="ALL Algo "
           href="/2024/04/17/Shortest-Path-%E2%85%A0/"
           data-tag="algorithm, find-the-shortest-path"
           data-author="" >
            <span class="post-title" title="Shortest Path Ⅰ">Shortest Path Ⅰ</span>
            <span class="post-date" title="2024-04-17 11:42:38">2024/04/17</span>
        </a>
        
        
        <a  class="ALL tools "
           href="/2024/04/16/Tools-hexo-hand-book/"
           data-tag="hexo"
           data-author="" >
            <span class="post-title" title="hexo hand book">hexo hand book</span>
            <span class="post-date" title="2024-04-16 23:06:14">2024/04/16</span>
        </a>
        
        
        <a  class="ALL ML "
           href="/2024/04/10/ML-Clustering-Practice/"
           data-tag="ML"
           data-author="sheldon" >
            <span class="post-title" title="ML-Clustering-Practice">ML-Clustering-Practice</span>
            <span class="post-date" title="2024-04-10 22:22:21">2024/04/10</span>
        </a>
        
        
        <a  class="ALL ML "
           href="/2024/04/01/ML-Introduction/"
           data-tag="ML"
           data-author="sheldon" >
            <span class="post-title" title="ML-Introduction">ML-Introduction</span>
            <span class="post-date" title="2024-04-01 13:25:25">2024/04/01</span>
        </a>
        
        
        <a  class="ALL DA "
           href="/2024/01/01/DA-01-Array/"
           data-tag="Data structure &amp; Algorithm"
           data-author="" >
            <span class="post-title" title="DA-Array">DA-Array</span>
            <span class="post-date" title="2024-01-01 13:50:00">2024/01/01</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-RV-Makefile" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">RV-Makefile</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="RISCV">RISCV</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color3">RV</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2024-07-10 22:11:33'>2024-06-30 23:43</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:1k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Makefile"><span class="toc-text">Makefile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gbdinit-%E6%96%87%E4%BB%B6"><span class="toc-text">gbdinit 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%A1%88%E4%BE%8B"><span class="toc-text">第一个案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#make-debug"><span class="toc-text">make debug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#make-hex"><span class="toc-text">make hex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#make-code"><span class="toc-text">make code</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-text">Reference</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h2><p>为了方便演示，后续的每一个案例代码将按照如下Makefile结构构建:</p>
<pre><code class="txt">asm/
    demo1/
        Makefile
        test.s
    demo2/
        Makefile
        test.s
    demo3/
        ...
rule.mk
common.mk
</code></pre>
<pre><code class="makefile"># asm/demo/Makefile
EXEC = test
SRC = $&#123;EXEC&#125;.s
GDBINIT = ../gdbinit
include ../rule.mk
</code></pre>
<pre><code class="makefile"># asm/rule.mk
include ../common.mk

.DEFAULT_GOAL := all
all:
    @$&#123;CC&#125; $&#123;CFLAGS&#125; $&#123;SRC&#125; -Ttext=0x80000000 -o $&#123;EXEC&#125;.elf
    @$&#123;OBJCOPY&#125; -O binary $&#123;EXEC&#125;.elf $&#123;EXEC&#125;.bin

.PHONY : run
run: all
    @echo &quot;Press Ctrl-A and then X to exit QEMU&quot;
    @echo &quot;------------------------------------&quot;
    @echo &quot;No output, please run &#39;make debug&#39; to see details&quot;
    @$&#123;QEMU&#125; $&#123;QFLAGS&#125; -kernel ./$&#123;EXEC&#125;.elf

.PHONY : debug
debug: all
    @echo &quot;Press Ctrl-C and then input &#39;quit&#39; to exit GDB and QEMU&quot;
    @echo &quot;-------------------------------------------------------&quot;
    @$&#123;QEMU&#125; $&#123;QFLAGS&#125; -kernel $&#123;EXEC&#125;.elf -s -S &amp; 
    @$&#123;GDB&#125; $&#123;EXEC&#125;.elf -q -x $&#123;GDBINIT&#125;
...
</code></pre>
<pre><code class="makefile">@$&#123;QEMU&#125; $&#123;QFLAGS&#125; -kernel $&#123;EXEC&#125;.elf -s -S &amp;
</code></pre>
<p>QEMU模拟器启动参数</p>
<ul>
<li><code>-s</code>: 启动gdbserver调试服务</li>
<li><code>-S-</code>: suspend 断点等待</li>
<li><code>&amp;</code>: 后台运行</li>
</ul>
<pre><code class="makefile">@$&#123;GDB&#125; $&#123;EXEC&#125;.elf -q -x $&#123;GDBINIT&#125;
</code></pre>
<p>QEMU模拟器启动参数</p>
<ul>
<li><code>-q</code>: quiet</li>
<li><code>-S-</code>: suspend 断点等待</li>
<li><code>x</code>: 执行 GDBINIT</li>
</ul>
<pre><code class="makefile"># common.mk

CROSS_COMPILE = riscv64-unknown-elf-
CFLAGS = -nostdlib -fno-builtin -march=rv32g -mabi=ilp32 -g -Wall

# QEMU系统模式模拟
QEMU = qemu-system-riscv32

# 非图形界面 单核 virt设备类型
QFLAGS = -nographic -smp 1 -machine virt -bios none  

# 调试器
GDB = gdb-multiarch
CC = $&#123;CROSS_COMPILE&#125;gcc
OBJCOPY = $&#123;CROSS_COMPILE&#125;objcopy
OBJDUMP = $&#123;CROSS_COMPILE&#125;objdump
</code></pre>
<h2 id="gbdinit-文件"><a href="#gbdinit-文件" class="headerlink" title="gbdinit 文件"></a>gbdinit 文件</h2><pre><code class="gbdinit">display/z $x5
display/z $x6
display/z $x7

set disassemble-next-line on
b _start
target remote : 1234
c
</code></pre>
<h2 id="第一个案例"><a href="#第一个案例" class="headerlink" title="第一个案例"></a>第一个案例</h2><p><strong>构建和使用说明</strong></p>
<ul>
<li><code>make</code>：编译构建</li>
<li><code>make run</code>：启动 qemu 并运行</li>
<li><code>make debug</code>：启动调试</li>
<li><code>make code</code>：反汇编查看二进制代码</li>
<li><code>make clean</code>：清理</li>
</ul>
<pre><code class="s"># Add
# Format:
# ADD RD, RS1, RS2
# Description:
# The contents of RS1 is added to the contents of RS2 and the result is 
# placed in RD.

  .text     # Define beginning of text section
  .global _start    # Define entry _start

_start:
  li x6, 1    # x6 = 1
  li x7, 2    # x7 = 2
  add x5, x6, x7    # x5 = x6 + x7

stop:
  j stop      # Infinite loop to stop execution

  .end      # End of file
</code></pre>
<h3 id="make-debug"><a href="#make-debug" class="headerlink" title="make debug"></a>make debug</h3><pre><code class="bash">&gt; make debug
</code></pre>
<pre><code class="txt">Press Ctrl-C and then input &#39;quit&#39; to exit GDB and QEMU
-------------------------------------------------------
Reading symbols from test.elf...
Breakpoint 1 at 0x80000000: file test.s, line 12.
0x00001000 in ?? ()
=&gt; 0x00001000:  97 02 00 00     auipc   t0,0x0
1: /z $x5 = 0x00000000
2: /z $x6 = 0x00000000
3: /z $x7 = 0x00000000

Breakpoint 1, _start () at test.s:12
12              li x6, 1                # x6 = 1
--Type &lt;RET&gt; for more, q to quit, c to continue without paging--si
=&gt; 0x80000000 &lt;_start+0&gt;:       13 03 10 00     li      t1,1
1: /z $x5 = 0x80000000
2: /z $x6 = 0x00000000
3: /z $x7 = 0x00000000
(gdb) si
13              li x7, 2                # x7 = 2
=&gt; 0x80000004 &lt;_start+4&gt;:       93 03 20 00     li      t2,2
1: /z $x5 = 0x80000000
2: /z $x6 = 0x00000001
3: /z $x7 = 0x00000000
(gdb) si
14              add x5, x6, x7          # x5 = x6 + x7
=&gt; 0x80000008 &lt;_start+8&gt;:       b3 02 73 00     add     t0,t1,t2
1: /z $x5 = 0x80000000
2: /z $x6 = 0x00000001
3: /z $x7 = 0x00000002
(gdb) 
stop () at test.s:17
17              j stop                  # Infinite loop to stop execution
=&gt; 0x8000000c &lt;stop+0&gt;: 6f 00 00 00     j       0x8000000c &lt;stop&gt;
1: /z $x5 = 0x00000003
2: /z $x6 = 0x00000001
3: /z $x7 = 0x00000002
(gdb) 
17              j stop                  # Infinite loop to stop execution
=&gt; 0x8000000c &lt;stop+0&gt;: 6f 00 00 00     j       0x8000000c &lt;stop&gt;
1: /z $x5 = 0x00000003
2: /z $x6 = 0x00000001
3: /z $x7 = 0x00000002
(gdb) 
</code></pre>
<ul>
<li>在gbdinit文件中，定义了<code>display/z $x5</code>, 会显示当前寄存器的数值</li>
<li>在gbdinit文件中，定义了<code>set disassemble-next-line on</code>逐句编译, 可以输入<code>si</code>(single instruction), 执行下一条指令。</li>
</ul>
<h3 id="make-hex"><a href="#make-hex" class="headerlink" title="make hex"></a>make hex</h3><pre><code class="bash">&gt; make hex
</code></pre>
<pre><code class="txt">00000000  13 03 10 00 93 03 20 00  b3 02 73 00 6f 00 00 00  |...... ...s.o...|
00000010
</code></pre>
<h3 id="make-code"><a href="#make-code" class="headerlink" title="make code"></a>make code</h3><pre><code class="bash">&gt; make code
</code></pre>
<pre><code class="txt">test.elf:     file format elf32-littleriscv


Disassembly of section .text:

80000000 &lt;_start&gt;:

        .text                   # Define beginning of text section
        .global _start          # Define entry _start

_start:
        li x6, 1                # x6 = 1
80000000:       00100313                li      t1,1
        li x7, 2                # x7 = 2
80000004:       00200393                li      t2,2
        add x5, x6, x7          # x5 = x6 + x7
80000008:       007302b3                add     t0,t1,t2

8000000c &lt;stop&gt;:

stop:
        j stop                  # Infinite loop to stop execution
8000000c:       0000006f                j       8000000c &lt;stop&gt;
(END)
</code></pre>
<p>上述案例显示了add操作经过编译后的结果<code>007302b3</code>。具体来说add属于R-type指令，通过查询手册得知，一条R-type指令的构成：</p>
<table>
<thead>
<tr>
<th>funct7</th>
<th>rs2</th>
<th>rs1</th>
<th>funct3</th>
<th>rd</th>
<th>opcode</th>
</tr>
</thead>
<tbody><tr>
<td>0000000</td>
<td>x7</td>
<td>x6</td>
<td>000</td>
<td>x5</td>
<td>0110011</td>
</tr>
<tr>
<td>0000000</td>
<td>00111</td>
<td>00110</td>
<td>000</td>
<td>00101</td>
<td>0110011</td>
</tr>
</tbody></table>
<ul>
<li>funct7、funct3、opcode确定了add指令</li>
<li>32bit 重新编排，注意字节序 <code>b3 02 73 00</code> -&gt; <code>00 73 02 b3</code></li>
</ul>
<table>
<thead>
<tr>
<th>0000</th>
<th>0000</th>
<th>0111</th>
<th>0011</th>
<th>0000</th>
<th>0010</th>
<th>1011</th>
<th>0011</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>7</td>
<td>3</td>
<td>0</td>
<td>2</td>
<td>b</td>
<td>3</td>
</tr>
</tbody></table>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://riscv.org/wp-content/uploads/2019/12/riscv-spec-20191213.pdf">The RISC-V Instruction Set Manual https://riscv.org/wp-content/uploads/2019/12/riscv-spec-20191213.pdf</a></li>
</ul>

      
       <hr><span style="font-style: italic;color: gray;"> Please cite the source for reprints, feel free to verify the sources cited in the article, and feel free to point out any errors or lack of clarity of expression. You can comment in the comments section below or email to 862314702@qq.com 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 862314702@qq.com </span>
    </div>
</article>



<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>RV-Makefile</p>
    <p><span class="copy-title">字数:</span><span class="post-count">1k</span></p>
    <p><span class="copy-title">本文作者:</span><a  title="Sheldon &amp; Vila">Sheldon &amp; Vila</a></p>
    <p><span class="copy-title">发布时间:</span>2024-06-30, 23:43:05</p>
    <p><span class="copy-title">最后更新:</span>2024-07-10, 22:11:33</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2024/06/30/RV-Makefile/" title="RV-Makefile">https://sheldoncoder1337.github.io/2024/06/30/RV-Makefile/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">&#34;署名-非商用-相同方式共享 4.0&#34;</a> 转载请保留原文链接及作者。
    </p>
</div>



    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: '4f33aa329333316d7b3e',
            clientSecret: 'b042f64bfd07ed32f8bb8c729eb6c2973e48f58d',
            repo: 'sheldoncoder1337.github.io',
            owner: 'sheldoncoder1337',
            admin: ['sheldoncoder1337'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2024 sheldoncoder1337
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
        /* 渲染*/
        function HTMLDecode(text) {
            var temp = document.createElement("div");
            temp.innerHTML = text;
            var output = temp.innerText || temp.textContent;
            temp = null;
            return output;
        }
        if (window.mermaid){
            window.mermaid = null
        }
        $.getScript("//cdn.jsdelivr.net/npm/mermaid@8.4.2/dist/mermaid.min.js", function () {
            var mermaidOptions = JSON.parse(HTMLDecode("{&#34;theme&#34;:&#34;default&#34;,&#34;startOnLoad&#34;:true,&#34;flowchart&#34;:{&#34;useMaxWidth&#34;:false,&#34;htmlLabels&#34;:true}}"))
            if (window.mermaid) {
                mermaid.initialize(mermaidOptions)
                mermaid.contentLoaded()
            }
        })
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>






</html>
