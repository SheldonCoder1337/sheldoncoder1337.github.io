<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ç¼–è¯‘ä¸é“¾æ¥</title>
      <link href="/2024/06/29/%E7%BC%96%E8%AF%91%E4%B8%8E%E9%93%BE%E6%8E%A5/"/>
      <url>/2024/06/29/%E7%BC%96%E8%AF%91%E4%B8%8E%E9%93%BE%E6%8E%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="ç»ƒä¹ -1"><a href="#ç»ƒä¹ -1" class="headerlink" title="ç»ƒä¹  1"></a>ç»ƒä¹  1</h2><p>ä½¿ç”¨ gcc ç¼–è¯‘ä»£ç å¹¶ä½¿ç”¨ binutils å·¥å…·å¯¹ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆELF æ ¼å¼ï¼‰è¿›è¡Œåˆ†æã€‚å…·ä½“è¦æ±‚å¦‚ä¸‹ï¼š</p><ul><li>ç¼–å†™ä¸€ä¸ªç®€å•çš„æ‰“å° â€œhello worldï¼â€ çš„ç¨‹åºæºæ–‡ä»¶ï¼šhello.c</li><li>å¯¹æºæ–‡ä»¶è¿›è¡Œæœ¬åœ°ç¼–è¯‘ï¼Œç”Ÿæˆé’ˆå¯¹æ”¯æŒ x86_64 æŒ‡ä»¤é›†æ¶æ„å¤„ç†å™¨çš„ç›®æ ‡æ–‡ä»¶ hello.oã€‚</li><li>æŸ¥çœ‹ hello.o çš„æ–‡ä»¶çš„æ–‡ä»¶å¤´ä¿¡æ¯ã€‚</li><li>æŸ¥çœ‹ hello.o çš„ Section header tableã€‚</li><li>å¯¹ hello.o åæ±‡ç¼–ï¼Œå¹¶æŸ¥çœ‹ hello.c çš„ C ç¨‹åºæºç å’Œæœºå™¨æŒ‡ä»¤çš„å¯¹åº”å…³ç³»ã€‚</li></ul><p><strong>è§£ç­”ï¼š</strong></p><p>1.ç¼–å†™ä¸€ä¸ªç®€å•çš„æ‰“å° â€œhello worldï¼â€ çš„ç¨‹åºæºæ–‡ä»¶ï¼šhello.c :</p><pre><code class="c">#include &lt;stdio.h&gt;void main()&#123;    printf(&quot;Hello, world!\n&quot;);&#125;</code></pre><p>2.å¯¹æºæ–‡ä»¶è¿›è¡Œæœ¬åœ°ç¼–è¯‘ï¼Œç”Ÿæˆé’ˆå¯¹æ”¯æŒ x86_64 æŒ‡ä»¤é›†æ¶æ„å¤„ç†å™¨çš„ç›®æ ‡æ–‡ä»¶ hello.o :</p><pre><code class="bash">&gt; gcc -c hello.c -o hello.o</code></pre><p>3.æŸ¥çœ‹ hello.o çš„æ–‡ä»¶çš„æ–‡ä»¶å¤´ä¿¡æ¯ã€‚</p><pre><code class="bash">&gt; readelf -h hello.oELF Header:  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00   Class:                             ELF64  Data:                              2&#39;s complement, little endian  Version:                           1 (current)  OS/ABI:                            UNIX - System V  ABI Version:                       0  Type:                              REL (Relocatable file)  Machine:                           Advanced Micro Devices X86-64  Version:                           0x1  Entry point address:               0x0  Start of program headers:          0 (bytes into file)  Start of section headers:          784 (bytes into file)  Flags:                             0x0  Size of this header:               64 (bytes)  Size of program headers:           0 (bytes)  Number of program headers:         0  Size of section headers:           64 (bytes)  Number of section headers:         14  Section header string table index: 13</code></pre><p>4.æŸ¥çœ‹ hello.o çš„ Section header tableã€‚</p><pre><code class="bash">&gt; readelf -SW hello.o  // è¿™é‡Œçš„Wå‚æ•°æ˜¯è®©å‘½ä»¤è¡Œè¾“å‡ºæ ·å¼ &quot;widely&quot;There are 14 section headers, starting at offset 0x310:Section Headers:  [Nr] Name              Type            Address          Off    Size   ES Flg Lk Inf Al  [ 0]                   NULL            0000000000000000 000000 000000 00      0   0  0  [ 1] .text             PROGBITS        0000000000000000 000040 000017 00  AX  0   0  1  [ 2] .rela.text        RELA            0000000000000000 000250 000030 18   I 11   1  8  [ 3] .data             PROGBITS        0000000000000000 000057 000000 00  WA  0   0  1  [ 4] .bss              NOBITS          0000000000000000 000057 000000 00  WA  0   0  1  [ 5] .rodata           PROGBITS        0000000000000000 000057 00000d 00   A  0   0  1  [ 6] .comment          PROGBITS        0000000000000000 000064 00002c 01  MS  0   0  1  [ 7] .note.GNU-stack   PROGBITS        0000000000000000 000090 000000 00      0   0  1  [ 8] .note.gnu.property NOTE            0000000000000000 000090 000020 00   A  0   0  8  [ 9] .eh_frame         PROGBITS        0000000000000000 0000b0 000038 00   A  0   0  8  [10] .rela.eh_frame    RELA            0000000000000000 000280 000018 18   I 11   9  8  [11] .symtab           SYMTAB          0000000000000000 0000e8 000138 18     12  10  8  [12] .strtab           STRTAB          0000000000000000 000220 000029 00      0   0  1  [13] .shstrtab         STRTAB          0000000000000000 000298 000074 00      0   0  1Key to Flags:  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),  L (link order), O (extra OS processing required), G (group), T (TLS),  C (compressed), x (unknown), o (OS specific), E (exclude),  l (large), p (processor specific)</code></pre><p>5.å¯¹ hello.o åæ±‡ç¼–ï¼Œå¹¶æŸ¥çœ‹ hello.c çš„ C ç¨‹åºæºç å’Œæœºå™¨æŒ‡ä»¤çš„å¯¹åº”å…³ç³»ã€‚é‡æ–°ç¼–è¯‘å¹¶æ·»åŠ è°ƒè¯•ä¿¡æ¯å‘½ä»¤ï¼šgcc -g -c</p><pre><code class="bash">&gt; rm hello.o&gt; gcc -g -c hello.c&gt; objdump -S hello.ohello.o:     file format elf64-x86-64Disassembly of section .text:0000000000000000 &lt;main&gt;:#include &lt;stdio.h&gt;void main()&#123;   0:   f3 0f 1e fa             endbr64    4:   55                      push   %rbp   5:   48 89 e5                mov    %rsp,%rbp        printf(&quot;hellp world!\n&quot;);   8:   48 8d 3d 00 00 00 00    lea    0x0(%rip),%rdi        # f &lt;main+0xf&gt;   f:   e8 00 00 00 00          callq  14 &lt;main+0x14&gt;&#125;  14:   90                      nop  15:   5d                      pop    %rbp  16:   c3                      retq   </code></pre><h2 id="ç»ƒä¹ -2"><a href="#ç»ƒä¹ -2" class="headerlink" title="ç»ƒä¹  2"></a>ç»ƒä¹  2</h2><p>å¦‚ä¸‹ä¾‹å­ C è¯­è¨€ä»£ç  example.cï¼š</p><pre><code class="c">#include &lt;stdio.h&gt;  int global_init = 0x11111111;         // åˆå§‹åŒ–å…¨å±€å˜é‡const int global_const = 0x22222222;  // åˆå§‹åŒ–å…¨å±€å˜é‡ void main() &#123;         static int static_var = 0x33333333;  // å·²ç»åˆå§‹åŒ–çš„é™æ€å˜é‡        static int static_var_uninit;        // æœªåˆå§‹åŒ–çš„é™æ€å˜é‡         int auto_var = 0x44444444;           // è‡ªåŠ¨å˜é‡         printf(&quot;hello world!\n&quot;);            // åªè¯»å­—ç¬¦ä¸²å¸¸é‡        return; &#125;</code></pre><p>è¯·é—®ç¼–è¯‘ä¸º .o æ–‡ä»¶åï¼Œglobal_init, global_const, static_var, static_var_uninit, auto_var è¿™äº›å˜é‡åˆ†åˆ«å­˜æ”¾åœ¨é‚£äº› section é‡Œï¼Œâ€hello world!\nâ€ è¿™ä¸ªå­—ç¬¦ä¸²åˆåœ¨å“ªé‡Œï¼Ÿå¹¶å°è¯•ç”¨å·¥å…·æŸ¥çœ‹å¹¶éªŒè¯ä½ çš„çŒœæµ‹ã€‚</p><p><strong>è§£ç­”ï¼š</strong> ç¼–è¯‘ä¸º .o æ–‡ä»¶åï¼Œè¿™äº›å˜é‡å’Œå­—ç¬¦ä¸²ä¼šè¢«æ”¾ç½®åœ¨ä¸åŒçš„ section ä¸­ï¼š</p><ul><li>global_init å’Œ global_const å­˜æ”¾åœ¨ .data section ä¸­ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€‚</li><li>static_var å­˜æ”¾åœ¨ .data section ä¸­ï¼Œå› ä¸ºå®ƒæ˜¯å·²åˆå§‹åŒ–çš„é™æ€å˜é‡ã€‚</li><li>static_var_uninit å­˜æ”¾åœ¨ .bss section ä¸­ï¼Œå› ä¸ºå®ƒæ˜¯æœªåˆå§‹åŒ–çš„é™æ€å˜é‡ã€‚</li><li>auto_var å­˜æ”¾åœ¨æ ˆä¸­ï¼Œå› ä¸ºå®ƒæ˜¯è‡ªåŠ¨å˜é‡ã€‚</li><li>â€œhello world!\nâ€ å­˜æ”¾åœ¨ .rodata section ä¸­ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåªè¯»å­—ç¬¦ä¸²å¸¸é‡ã€‚</li></ul><p>å¯ä»¥ä½¿ç”¨ gcc -c example.c å‘½ä»¤æ¥ç¼–è¯‘ç”Ÿæˆ .o æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ readelf -a example.o å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚å…¶ä¸­ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°å„ä¸ª section çš„èµ·å§‹åœ°å€ã€å¤§å°ç­‰ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹åˆ°å­—ç¬¦ä¸²å¸¸é‡çš„ä½ç½®å’Œå†…å®¹ä¿¡æ¯ã€‚</p><pre><code class="bash">&gt; gcc -c example.c -o example.o&gt; readelf -a examlple.o&gt; readelf -aW example.oELF Header:  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00   Class:                             ELF64  Data:                              2&#39;s complement, little endian  Version:                           1 (current)  OS/ABI:                            UNIX - System V  ABI Version:                       0  Type:                              REL (Relocatable file)  Machine:                           Advanced Micro Devices X86-64  Version:                           0x1  Entry point address:               0x0  Start of program headers:          0 (bytes into file)  Start of section headers:          976 (bytes into file)  Flags:                             0x0  Size of this header:               64 (bytes)  Size of program headers:           0 (bytes)  Number of program headers:         0  Size of section headers:           64 (bytes)  Number of section headers:         14  Section header string table index: 13Section Headers:  [Nr] Name              Type            Address          Off    Size   ES Flg Lk Inf Al  [ 0]                   NULL            0000000000000000 000000 000000 00      0   0  0  [ 1] .text             PROGBITS        0000000000000000 000040 000022 00  AX  0   0  1  [ 2] .rela.text        RELA            0000000000000000 000310 000030 18   I 11   1  8  [ 3] .data             PROGBITS        0000000000000000 000064 000008 00  WA  0   0  4  [ 4] .bss              NOBITS          0000000000000000 00006c 000004 00  WA  0   0  4  [ 5] .rodata           PROGBITS        0000000000000000 00006c 000011 00   A  0   0  4  [ 6] .comment          PROGBITS        0000000000000000 00007d 00002c 01  MS  0   0  1  [ 7] .note.GNU-stack   PROGBITS        0000000000000000 0000a9 000000 00      0   0  1  [ 8] .note.gnu.property NOTE            0000000000000000 0000b0 000020 00   A  0   0  8  [ 9] .eh_frame         PROGBITS        0000000000000000 0000d0 000038 00   A  0   0  8  [10] .rela.eh_frame    RELA            0000000000000000 000340 000018 18   I 11   9  8  [11] .symtab           SYMTAB          0000000000000000 000108 000198 18     12  12  8  [12] .strtab           STRTAB          0000000000000000 0002a0 00006b 00      0   0  1  [13] .shstrtab         STRTAB          0000000000000000 000358 000074 00      0   0  1Key to Flags:  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),  L (link order), O (extra OS processing required), G (group), T (TLS),  C (compressed), x (unknown), o (OS specific), E (exclude),  l (large), p (processor specific)...The decoding of unwind sections for machine type Advanced Micro Devices X86-64 is not currently supported.Symbol table &#39;.symtab&#39; contains 17 entries:   Num:    Value          Size Type    Bind   Vis      Ndx Name     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND      1: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS example.c     2: 0000000000000000     0 SECTION LOCAL  DEFAULT    1      3: 0000000000000000     0 SECTION LOCAL  DEFAULT    3      4: 0000000000000000     0 SECTION LOCAL  DEFAULT    4      5: 0000000000000000     0 SECTION LOCAL  DEFAULT    5      6: 0000000000000000     4 OBJECT  LOCAL  DEFAULT    4 static_var_uninit.2318     7: 0000000000000004     4 OBJECT  LOCAL  DEFAULT    3 static_var.2317     8: 0000000000000000     0 SECTION LOCAL  DEFAULT    7      9: 0000000000000000     0 SECTION LOCAL  DEFAULT    8     10: 0000000000000000     0 SECTION LOCAL  DEFAULT    9     11: 0000000000000000     0 SECTION LOCAL  DEFAULT    6     12: 0000000000000000     4 OBJECT  GLOBAL DEFAULT    3 global_init    13: 0000000000000000     4 OBJECT  GLOBAL DEFAULT    5 global_const    14: 0000000000000000    34 FUNC    GLOBAL DEFAULT    1 main    15: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND _GLOBAL_OFFSET_TABLE_    16: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND puts...</code></pre><p>ä»è¿”å›çš„ELFä¿¡æ¯å¯ä»¥çœ‹åˆ°ï¼Œ</p><ul><li><p>global_init å’Œ static_var å­˜æ”¾åœ¨ [3]å·æ®µ, å³.data section ä¸­ï¼Œå·²åˆå§‹åŒ–çš„é™æ€å˜é‡å’Œæœªåˆå§‹åŒ–çš„é™æ€å˜é‡ã€‚</p></li><li><p>static_var_uninit å­˜æ”¾åœ¨[4]å·æ®µå³.bss section ä¸­ï¼Œå› ä¸ºå®ƒæ˜¯æœªåˆå§‹åŒ–çš„é™æ€å˜é‡ã€‚</p></li><li><p>global_const, â€œhello world!\nâ€ å­˜æ”¾åœ¨[5]å·æ®µå³ .rodata section ä¸­ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä¸€ä¸ªåªè¯»å­—ç¬¦ä¸²å¸¸é‡ã€‚</p></li><li><p>auto_var å­˜æ”¾åœ¨æ ˆä¸­ï¼Œå› ä¸ºå®ƒæ˜¯è‡ªåŠ¨å˜é‡</p></li></ul><h2 id="ç»ƒä¹ -3"><a href="#ç»ƒä¹ -3" class="headerlink" title="ç»ƒä¹  3"></a>ç»ƒä¹  3</h2><p>ç†Ÿæ‚‰äº¤å‰ç¼–è¯‘æ¦‚å¿µï¼Œä½¿ç”¨ riscv gcc ç¼–è¯‘ä»£ç å¹¶ä½¿ç”¨ binutils å·¥å…·å¯¹ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆELF æ ¼å¼ï¼‰è¿›è¡Œåˆ†æã€‚å…·ä½“è¦æ±‚å¦‚ä¸‹ï¼š</p><ul><li>ç¼–å†™ä¸€ä¸ªç®€å•çš„æ‰“å° â€œhello worldï¼â€ çš„ç¨‹åºæºæ–‡ä»¶ï¼šhello.c</li><li>å¯¹æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œç”Ÿæˆé’ˆå¯¹æ”¯æŒ rv32ima æŒ‡ä»¤é›†æ¶æ„å¤„ç†å™¨çš„ç›®æ ‡æ–‡ä»¶ hello.oã€‚</li><li>æŸ¥çœ‹ hello.o çš„æ–‡ä»¶çš„æ–‡ä»¶å¤´ä¿¡æ¯ã€‚</li><li>æŸ¥çœ‹ hello.o çš„ Section header tableã€‚</li><li>å¯¹ hello.o åæ±‡ç¼–ï¼Œå¹¶æŸ¥çœ‹ hello.c çš„ C</li></ul><p><strong>è§£ç­”</strong></p><p>1.ç¼–å†™ä¸€ä¸ªç®€å•çš„æ‰“å° â€œhello worldï¼â€ çš„ç¨‹åºæºæ–‡ä»¶ï¼šhello.c</p><pre><code class="c">#include &lt;stdio.h&gt;void main()&#123;    printf(&quot;hellp world!\n&quot;);&#125;</code></pre><pre><code class="bash">&gt; riscv64-unknown-elf-gcc -march=rv32ima -mabi=ilp32 hello.c hello.c:1:10: fatal error: stdio.h: No such file or directory    1 | #include &lt;stdio.h&gt;      |          ^~~~~~~~~compilation terminated.</code></pre><p>å¦‚æœæŠ¥é”™ï¼Œå¯ä»¥æ¢æˆriscv64-linux-gun-gcc</p><pre><code class="bash">$ sudo apt -y install gcc-riscv64-linux-gun$ riscv64-linux-gun-gcc hello.c$ file a.outa.out: ELF 64-bit LSB shared object, UCB RISC-V, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux-riscv64-lp64d.so.1, BuildID[sha1]=6b3277a79e18ad6acfa00fb14e8f73a2b33fa3a3, for GNU/Linux 4.15.0, not stripped</code></pre><p>2.å¯¹æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œç”Ÿæˆé’ˆå¯¹æ”¯æŒ rv32ima æŒ‡ä»¤é›†æ¶æ„å¤„ç†å™¨çš„ç›®æ ‡æ–‡ä»¶ hello.oã€‚</p><pre><code class="bash">&gt; riscv64-linux-gnu-gcc -c hello.c -o hello.o</code></pre><p>3.æŸ¥çœ‹ hello.o çš„æ–‡ä»¶çš„æ–‡ä»¶å¤´ä¿¡æ¯ã€‚</p><pre><code class="bash">&gt; readelf -h hello.oELF Header:  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00   Class:                             ELF64  Data:                              2&#39;s complement, little endian  Version:                           1 (current)  OS/ABI:                            UNIX - System V  ABI Version:                       0  Type:                              REL (Relocatable file)  Machine:                           RISC-V  Version:                           0x1  Entry point address:               0x0  Start of program headers:          0 (bytes into file)  Start of section headers:          712 (bytes into file)  Flags:                             0x5, RVC, double-float ABI  Size of this header:               64 (bytes)  Size of program headers:           0 (bytes)  Number of program headers:         0  Size of section headers:           64 (bytes)  Number of section headers:         11  Section header string table index: 10</code></pre><p>Machine: RISC-V</p><p>4.æŸ¥çœ‹ hello.o çš„ Section header tableã€‚</p><pre><code class="bash">&gt; readelf -SW hello.oThere are 11 section headers, starting at offset 0x2c8:Section Headers:  [Nr] Name              Type            Address          Off    Size   ES Flg Lk Inf Al  [ 0]                   NULL            0000000000000000 000000 000000 00      0   0  0  [ 1] .text             PROGBITS        0000000000000000 000040 000022 00  AX  0   0  2  [ 2] .rela.text        RELA            0000000000000000 0001e0 000090 18   I  8   1  8  [ 3] .data             PROGBITS        0000000000000000 000062 000000 00  WA  0   0  1  [ 4] .bss              NOBITS          0000000000000000 000062 000000 00  WA  0   0  1  [ 5] .rodata           PROGBITS        0000000000000000 000068 00000d 00   A  0   0  8  [ 6] .comment          PROGBITS        0000000000000000 000075 00002a 01  MS  0   0  1  [ 7] .note.GNU-stack   PROGBITS        0000000000000000 00009f 000000 00      0   0  1  [ 8] .symtab           SYMTAB          0000000000000000 0000a0 000120 18      9  10  8  [ 9] .strtab           STRTAB          0000000000000000 0001c0 00001d 00      0   0  1  [10] .shstrtab         STRTAB          0000000000000000 000270 000052 00      0   0  1Key to Flags:  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),  L (link order), O (extra OS processing required), G (group), T (TLS),  C (compressed), x (unknown), o (OS specific), E (exclude),  p (processor specific)</code></pre><p>å¯¹æ¯”linux-gccç¼–è¯‘çš„hello.o å°‘äº†3ä¸ªsection</p><pre><code class="bash">[ 8] .note.gnu.property NOTE[ 9] .eh_frame         PROGBITS [10] .rela.eh_frame    RELA </code></pre><p>5.å¯¹ hello.o åæ±‡ç¼–ï¼Œå¹¶æŸ¥çœ‹ hello.c çš„ C</p><pre><code class="bash">$ riscv64-linux-gnu-gcc -g -c hello.c$ riscv64-linux-gnu-objdump -d hello.ohello.o:     file format elf64-littleriscvDisassembly of section .text:0000000000000000 &lt;main&gt;:#include &lt;stdio.h&gt;void main()&#123;   0:   1141                    addi    sp,sp,-16   2:   e406                    sd      ra,8(sp)   4:   e022                    sd      s0,0(sp)   6:   0800                    addi    s0,sp,16        printf(&quot;hellp world!\n&quot;);   8:   00000517                auipc   a0,0x0   c:   00050513                mv      a0,a0  10:   00000097                auipc   ra,0x0  14:   000080e7                jalr    ra # 10 &lt;main+0x10&gt;&#125;  18:   0001                    nop  1a:   60a2                    ld      ra,8(sp)  1c:   6402                    ld      s0,0(sp)  1e:   0141                    addi    sp,sp,16  20:   8082                    ret</code></pre><h2 id="ç»ƒä¹ -4"><a href="#ç»ƒä¹ -4" class="headerlink" title="ç»ƒä¹  4"></a>ç»ƒä¹  4</h2><p>åŸºäº ç»ƒä¹  3 ç»§ç»­ç†Ÿæ‚‰ qemu&#x2F;gdb ç­‰å·¥å…·çš„ä½¿ç”¨ï¼Œå…·ä½“è¦æ±‚å¦‚ä¸‹ï¼š</p><ul><li>å°† hello.c ç¼–è¯‘æˆå¯è°ƒå¼ç‰ˆæœ¬çš„å¯æ‰§è¡Œç¨‹åº a.out</li><li>å…ˆæ‰§è¡Œ qemu-riscv32 è¿è¡Œ a.outã€‚</li><li>ä½¿ç”¨ qemu-riscv32 å’Œ gdb è°ƒè¯• a.outã€‚</li></ul><pre><code class="bash">&gt; riscv64-linux-gnu-gcc -march=rv32im -mabi=ilp32 -g hello.c -o a.out&gt; qemu-riscv32 ./a.out</code></pre><h2 id="ç»ƒä¹ -5"><a href="#ç»ƒä¹ -5" class="headerlink" title="ç»ƒä¹  5"></a>ç»ƒä¹  5</h2><p>è‡ªå­¦ Makefile çš„è¯­æ³•ï¼Œç†è§£åœ¨ riscv ä»“åº“çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œ make ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><pre><code class="makefile">include ../../common.mkSRCS_ASM = \    start.S \SRCS_C = \    kernel.c \OBJS = $(SRCS_ASM:.S=.o)OBJS += $(SRCS_C:.c=.o).DEFAULT_GOAL := allall: os.elf# start.o must be the first in dependency!os.elf: $&#123;OBJS&#125;    $&#123;CC&#125; $&#123;CFLAGS&#125; -Ttext=0x80000000 -o os.elf $^    $&#123;OBJCOPY&#125; -O binary os.elf os.bin%.o : %.c    $&#123;CC&#125; $&#123;CFLAGS&#125; -c -o $@ $&lt;%.o : %.S    $&#123;CC&#125; $&#123;CFLAGS&#125; -c -o $@ $&lt;run: all    @$&#123;QEMU&#125; -M ? | grep virt &gt;/dev/null || exit    @echo &quot;Press Ctrl-A and then X to exit QEMU&quot;    @echo &quot;------------------------------------&quot;    @$&#123;QEMU&#125; $&#123;QFLAGS&#125; -kernel os.elf.PHONY : debugdebug: all    @echo &quot;Press Ctrl-C and then input &#39;quit&#39; to exit GDB and QEMU&quot;    @echo &quot;-------------------------------------------------------&quot;    @$&#123;QEMU&#125; $&#123;QFLAGS&#125; -kernel os.elf -s -S &amp;    @$&#123;GDB&#125; os.elf -q -x ../gdbinit.PHONY : codecode: all    @$&#123;OBJDUMP&#125; -S os.elf | less.PHONY : cleanclean:    rm -rf *.o *.bin *.elf</code></pre>]]></content>
      
      
      <categories>
          
          <category> RISCV </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>RISCV-pre</title>
      <link href="/2024/06/29/RISCV-pre/"/>
      <url>/2024/06/29/RISCV-pre/</url>
      
        <content type="html"><![CDATA[<p>ä»é›¶å¼€å§‹ä¸º RISC-V å¹³å°ç¼–å†™ä¸€ä¸ªç®€å•çš„æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚</p><h2 id="1-ç¯å¢ƒé…ç½®"><a href="#1-ç¯å¢ƒé…ç½®" class="headerlink" title="1.ç¯å¢ƒé…ç½®"></a>1.ç¯å¢ƒé…ç½®</h2><p>æ¨èä½¿ç”¨ Ubuntu 20.04ï¼ŒUbuntu 20.04 æ˜¯ç›®å‰æœ€æ–°çš„ Ubuntu é•¿æœŸç¨³å®šå‘è¡Œç‰ˆï¼Œåœ¨è¿™ä¸ªç¯å¢ƒä¸‹å®‰è£…è¿è¡Œç¯å¢ƒä¹Ÿæœ€ç®€å•ã€‚</p><p>æ‰€æœ‰æ¼”ç¤ºä»£ç åœ¨ä»¥ä¸‹ç¯å¢ƒä¸‹éªŒè¯é€šè¿‡ï¼Œè¯·ä»”ç»†æ ¸å¯¹ä½ çš„ Ubuntu ç‰ˆæœ¬å’Œå†…æ ¸ç‰ˆæœ¬ä¸ä»¥ä¸‹ä¿¡æ¯æ˜¯å¦ä¸€è‡´ã€‚</p><pre><code class="bash">$ lsb_release -aNo LSB modules are available.Distributor ID:UbuntuDescription:Ubuntu 20.04.3 LTSRelease:20.04Codename:focal$ uname -r5.11.0-27-generic</code></pre><p>ç›®å‰åœ¨ Ubuntu 20.04 ç¯å¢ƒä¸‹æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„ GNUå·¥å…·é“¾å’Œ QEMU æ¨¡æ‹Ÿå™¨ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åœ¨çº¿å®‰è£…å³å¯å¼€å§‹è¯•éªŒï¼š</p><pre><code class="bash">$ sudo apt update$ sudo apt install build-essential gcc make perl dkms git gcc-riscv64-unknown-elf gdb-multiarch qemu-system-misc</code></pre><p>ä»¥ä¸‹æ˜¯æ¯ä¸ªä¾èµ–é¡¹çš„ç®€è¦è¯´æ˜ï¼š</p><ul><li>build-essentialï¼šè¯¥è½¯ä»¶åŒ…æä¾›äº†ç¼–è¯‘å’Œæ„å»ºè½¯ä»¶æ‰€éœ€çš„åŸºæœ¬å·¥å…·ï¼ŒåŒ…æ‹¬ç¼–è¯‘å™¨å’ŒCåº“ã€‚</li><li>gccï¼šGNUç¼–è¯‘å™¨é›†åˆï¼Œç”¨äºç¼–è¯‘Cå’ŒC++ç¨‹åºã€‚</li><li>makeï¼šä¸€ä¸ªæ„å»ºå·¥å…·ï¼Œç”¨äºè‡ªåŠ¨åŒ–è½¯ä»¶æ„å»ºè¿‡ç¨‹ã€‚</li><li>perlï¼šä¸€ç§è„šæœ¬è¯­è¨€ï¼Œå¸¸ç”¨äºæ–‡æœ¬å¤„ç†å’Œç³»ç»Ÿç®¡ç†ä»»åŠ¡ã€‚</li><li>dkmsï¼šåŠ¨æ€å†…æ ¸æ¨¡å—æ”¯æŒï¼Œç”¨äºè‡ªåŠ¨ç¼–è¯‘å’Œå®‰è£…å†…æ ¸æ¨¡å—ã€‚</li><li>gitï¼šç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç”¨äºè·Ÿè¸ªå’Œç®¡ç†é¡¹ç›®ä»£ç ã€‚</li><li>gcc-riscv64-unknown-elfï¼šRISC-Væ¶æ„çš„äº¤å‰ç¼–è¯‘å™¨ï¼Œç”¨äºç¼–è¯‘RISC-Væ¶æ„çš„ç¨‹åºã€‚</li><li>gdb-multiarchï¼šä¸€ä¸ªå¤šæ¶æ„è°ƒè¯•å™¨ï¼Œæ”¯æŒå¤šç§æ¶æ„çš„ç¨‹åºè°ƒè¯•ã€‚</li><li>qemu-system-miscï¼šQEMUæ¨¡æ‹Ÿå™¨çš„ä¸€éƒ¨åˆ†ï¼ŒåŒ…å«äº†ä¸€äº›æ‚é¡¹å·¥å…·å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li></ul><p>ä½¿ç”¨åŒ…ç®¡ç†å™¨ï¼šåœ¨ç»ˆç«¯ä¸­è¿è¡Œdpkg -s &lt;package-name&gt; å‘½ä»¤ï¼Œå°†&lt;package-name&gt;æ›¿æ¢ä¸ºè¦æ£€æŸ¥çš„è½¯ä»¶åŒ…åç§°ã€‚å¦‚æœè½¯ä»¶åŒ…å·²æˆåŠŸå®‰è£…ï¼Œå°†æ˜¾ç¤ºè½¯ä»¶åŒ…çš„è¯¦ç»†ä¿¡æ¯ï¼›å¦åˆ™ï¼Œå°†æ˜¾ç¤ºè½¯ä»¶åŒ…æœªå®‰è£…çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œdpkg -s gccå°†æ£€æŸ¥GCCç¼–è¯‘å™¨æ˜¯å¦å·²å®‰è£…ã€‚</p><pre><code class="bash">$ dpkg -s gccPackage: gccStatus: install ok installedPriority: optionalSection: develInstalled-Size: 50Maintainer: Ubuntu Developers &lt;ubuntu-devel-discuss@lists.ubuntu.com&gt;Architecture: amd64Source: gcc-defaults (1.185.1ubuntu2)Version: 4:9.3.0-1ubuntu2Provides: c-compiler, gcc-x86-64-linux-gnu (= 4:9.3.0-1ubuntu2)Depends: cpp (= 4:9.3.0-1ubuntu2), gcc-9 (&gt;= 9.3.0-3~)Recommends: libc6-dev | libc-devSuggests: gcc-multilib, make, manpages-dev, autoconf, automake, libtool, flex, bison, gdb, gcc-docConflicts: gcc-doc (&lt;&lt; 1:2.95.3)Description: GNU C compiler This is the GNU C compiler, a fairly portable optimizing compiler for C. . This is a dependency package providing the default GNU C compiler.Original-Maintainer: Debian GCC Maintainers &lt;debian-gcc@lists.debian.org&gt;</code></pre><h2 id="2-æ„å»ºå’Œä½¿ç”¨è¯´æ˜"><a href="#2-æ„å»ºå’Œä½¿ç”¨è¯´æ˜" class="headerlink" title="2. æ„å»ºå’Œä½¿ç”¨è¯´æ˜"></a>2. æ„å»ºå’Œä½¿ç”¨è¯´æ˜</h2><ul><li><code>make</code>ï¼šç¼–è¯‘æ„å»º</li><li><code>make run</code>ï¼šå¯åŠ¨ qemu å¹¶è¿è¡Œ</li><li><code>make debug</code>ï¼šå¯åŠ¨è°ƒè¯•</li><li><code>make code</code>ï¼šåæ±‡ç¼–æŸ¥çœ‹äºŒè¿›åˆ¶ä»£ç </li><li><code>make clean</code>ï¼šæ¸…ç†</li></ul><p>å…·ä½“ä½¿ç”¨è¯·å‚è€ƒå…·ä½“å­é¡¹ç›®ä¸‹çš„ Makefile æ–‡ä»¶ã€‚</p><h2 id="3-å‚è€ƒæ–‡çŒ®"><a href="#3-å‚è€ƒæ–‡çŒ®" class="headerlink" title="3. å‚è€ƒæ–‡çŒ®"></a>3. å‚è€ƒæ–‡çŒ®</h2><p>æœ¬é¡¹ç›®çš„è®¾è®¡å‚è€ƒäº†å¦‚ä¸‹ç½‘ç»œèµ„æºï¼Œåœ¨æ­¤è¡¨ç¤ºæ„Ÿè°¢ :)</p><ul><li>The Adventures of OSï¼š<a href="https://osblog.stephenmarz.com/index.html">https://osblog.stephenmarz.com/index.html</a></li><li>mini-riscv-os: <a href="https://github.com/cccriscv/mini-riscv-os">https://github.com/cccriscv/mini-riscv-os</a></li><li>Xv6, a simple Unix-like teaching operating systemï¼š<a href="https://pdos.csail.mit.edu/6.828/2020/xv6.html">https://pdos.csail.mit.edu/6.828/2020/xv6.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> RISCV </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WSLå‘½ä»¤é€ŸæŸ¥</title>
      <link href="/2024/06/29/WSL%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/"/>
      <url>/2024/06/29/WSL%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/</url>
      
        <content type="html"><![CDATA[<p>åˆ—å‡ºå¯ç”¨çš„Linuxå‘è¡Œç‰ˆ</p><pre><code class="PowerShell">wsl --list --online</code></pre><p>åˆ—å‡ºå·²å®‰è£…çš„ Linux å‘è¡Œç‰ˆ</p><pre><code class="PowerShell">wsl --list --verbose</code></pre><p>è®¾ç½®é»˜è®¤ WSL ç‰ˆæœ¬</p><pre><code class="PowerShell">wsl --set-default-version &lt;Version&gt;</code></pre><p>ä¾‹å­</p><pre><code class="PowerShell">&gt; wsl -l --all -v&gt; wsl --export Ubuntu-20.04 E:\wsl\ubuntu-20.04.tar&gt; wsl --unregister Ubuntu-20.04&gt; wsl --import Ubuntu-20.04 E:\wsl E:\wsl\ubuntu-20.04.tar&gt; wsl --set-default Ubuntu-20.04&gt; wsl -d Ubuntu-20.04</code></pre>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>RISCV-Intro</title>
      <link href="/2024/06/25/RISCV-Intro/"/>
      <url>/2024/06/25/RISCV-Intro/</url>
      
        <content type="html"><![CDATA[<h2 id="RISCV-ISA-å‘½åè§„èŒƒ"><a href="#RISCV-ISA-å‘½åè§„èŒƒ" class="headerlink" title="RISCV ISA å‘½åè§„èŒƒ"></a>RISCV ISA å‘½åè§„èŒƒ</h2><ul><li>RISC-V ISAé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡</li><li><strong>ISA &#x3D; 1ä¸ªåŸºæœ¬æ•´æ•°æŒ‡ä»¤é›†+å¤šä¸ªå¯é€‰çš„æ‰©å±•æŒ‡ä»¤é›†</strong></li></ul><table><thead><tr><th>åŸºæœ¬æŒ‡ä»¤é›†</th><th>æè¿°</th></tr></thead><tbody><tr><td>RV32I</td><td>32ä½æ•´æ•°æŒ‡ä»¤é›†</td></tr><tr><td>RV32E</td><td>RV32Içš„å­é›†ï¼Œç”¨äºå°å‹åµŒå…¥å¼åœºæ™¯ï¼Œå¯„å­˜å™¨æ•°å°‘</td></tr><tr><td>RV64I</td><td>64ä½æ•´æ•°æŒ‡ä»¤é›†ï¼Œå…¼å®¹RV32I</td></tr><tr><td>RV128I</td><td>128ä½æ•´æ•°æŒ‡ä»¤é›†ï¼Œå…¼å®¹RV64Iå’ŒRV32I</td></tr></tbody></table><table><thead><tr><th>æ‰©å±•æŒ‡ä»¤é›†</th><th>æè¿°</th></tr></thead><tbody><tr><td>M</td><td>æ•´æ•°ä¹˜é™¤æ³•(<strong>M</strong>ultiplication)æŒ‡ä»¤é›†</td></tr><tr><td>A</td><td>å­˜å‚¨å™¨åŸå­(<strong>A</strong>tomic)æŒ‡ä»¤é›†</td></tr><tr><td>F</td><td>å•ç²¾åº¦(32bit)æµ®ç‚¹ï¼ˆ<strong>F</strong>loatï¼‰æŒ‡ä»¤é›†</td></tr><tr><td>D</td><td>åŒç²¾åº¦(64bit)æµ®ç‚¹ï¼ˆ<strong>D</strong>oubleï¼‰æŒ‡ä»¤é›†</td></tr><tr><td>C</td><td>å‹ç¼©(<strong>C</strong>ompressed)æŒ‡ä»¤é›†</td></tr><tr><td>â€¦â€¦</td><td>å…¶ä»–æ ‡å‡†åŒ–å’Œéæ ‡å‡†åŒ–çš„æŒ‡ä»¤é›†</td></tr></tbody></table><ul><li>åŸºæœ¬æ•´æ•°(Integer)æŒ‡ä»¤é›†<ul><li>å”¯ä¸€å¼ºåˆ¶è¦æ±‚å®ç°çš„åŸºç¡€æŒ‡ä»¤é›†ï¼Œå…¶ä»–æŒ‡ä»¤é›†éƒ½æ˜¯å¯é€‰çš„æ‰©å±•æ¨¡å—</li></ul></li><li>æ‰©å±•æ¨¡å—æŒ‡ä»¤é›†<ul><li>RISC-Vå…è®¸åœ¨å®ç°ä¸­ä»¥å¯é€‰çš„å½¢å¼å®ç°å…¶ä»–æ ‡å‡†åŒ–å’Œéæ ‡å‡†åŒ–çš„æŒ‡ä»¤é›†æ‰©å±•</li><li>ç‰¹å®šç»„åˆâ€IMAFDâ€è¢«ç§°ä¸ºâ€é€šç”¨(General)â€ç»„åˆï¼Œç”¨è‹±æ–‡å­—æ¯Gè¡¨ç¤º</li></ul></li><li>ISAå‘½åæ ¼å¼ï¼šRV-xx-abc<ul><li>RV: RISC-Vçš„ç¼©å†™</li><li>xx: å¤„ç†å™¨çš„å­—å®½ï¼Œå³å¯„å­˜å™¨çš„å®½åº¦(bit)</li><li>abcâ€¦xyz: è¯¥å¤„ç†å™¨æ”¯æŒçš„æŒ‡ä»¤é›†æ¨¡å—é›†åˆ</li></ul></li><li>ä¾‹å¦‚<ul><li>RV32I:æœ€åŸºæœ¬çš„RISCVå®ç°</li><li>RV32IMAï¼š32ä½å®ç°ï¼Œæ”¯æŒInteger+Multiply+Atomic+Compressed</li><li>RV64GCï¼š64ä½å®ç°ï¼Œæ”¯æŒIMAFDC</li></ul></li></ul><h2 id="RISC-V-ç‰¹æƒæŒ‡ä»¤ç»“æ„"><a href="#RISC-V-ç‰¹æƒæŒ‡ä»¤ç»“æ„" class="headerlink" title="RISC-V ç‰¹æƒæŒ‡ä»¤ç»“æ„"></a>RISC-V ç‰¹æƒæŒ‡ä»¤ç»“æ„</h2><h3 id="HART-â€œç¡¬ä»¶çº¿ç¨‹â€"><a href="#HART-â€œç¡¬ä»¶çº¿ç¨‹â€" class="headerlink" title="HART â€œç¡¬ä»¶çº¿ç¨‹â€"></a>HART â€œç¡¬ä»¶çº¿ç¨‹â€</h3><p>HART &#x3D; HARdware Thread ï¼Œæ˜¯æŒ‡ä»¤æ‰§è¡Œæµçš„æœ€å°æ‰§è¡Œå•ä½</p><blockquote><p>From the perspective of software running in a given execution enviroment, a <strong>hart</strong> is a <strong>resource</strong> that autonomously fetched and executes RISC-V instruction within that execution enviroment. â€”â€” ã€ŠThe RISC-V Instruction Set Manualã€‹</p></blockquote><h3 id="Privileged-Level-ç‰¹æƒçº§åˆ«"><a href="#Privileged-Level-ç‰¹æƒçº§åˆ«" class="headerlink" title="Privileged Level ç‰¹æƒçº§åˆ«"></a>Privileged Level ç‰¹æƒçº§åˆ«</h3><p>ä¸X86 ISAé‡Œçš„å®æ¨¡å¼å’Œä¿æŠ¤æ¨¡å¼ç±»ä¼¼</p><p>RISCVé‡Œå¯¹åº”ç€Machineæ¨¡å¼ï¼ŒSupervisoræ¨¡å¼ï¼ŒUseræ¨¡å¼</p><p>MMU(å†…å­˜ç®¡ç†å•å…ƒ)</p><h3 id="CSR"><a href="#CSR" class="headerlink" title="CSR"></a>CSR</h3><p>CSR - Control and Status Register</p><ul><li>ä¸åŒçš„ç‰¹æƒçº§åˆ«ä¸‹æ—¶åˆ†åˆ«å¯¹åº”<strong>å„è‡ªä¸€å¥—Register(CSR)</strong>, ç”¨äºæ§åˆ¶å’Œè·å–ç›¸åº”Levelä¸‹çš„å¤„ç†å™¨å·¥ä½œçŠ¶æ€ã€‚</li></ul><h3 id="å†…å­˜ç®¡ç†ä¸ä¿æŠ¤"><a href="#å†…å­˜ç®¡ç†ä¸ä¿æŠ¤" class="headerlink" title="å†…å­˜ç®¡ç†ä¸ä¿æŠ¤"></a>å†…å­˜ç®¡ç†ä¸ä¿æŠ¤</h3><ul><li><strong>ç‰©ç†å†…å­˜</strong>ä¿æŠ¤ (Physical Memory Protection, PMP)<ul><li>å…è®¸Mæ¨¡å¼æŒ‡å®šUæ¨¡å¼å¯ä»¥è®¿é—®çš„å†…å­˜åœ°å€</li><li>æ”¯æŒ R&#x2F;W&#x2F;Xï¼Œä»¥åŠLock</li></ul></li><li><strong>è™šæ‹Ÿå†…å­˜</strong><ul><li>éœ€è¦æ”¯æŒSupervisor Level</li><li>ç”¨äºå®ç°é«˜çº§çš„æ“ä½œç³»ç»Ÿç‰¹å¾(Unix&#x2F;Linux)</li><li>å¤šç§æ˜ å°„æ–¹å¼Sv32&#x2F;Sv39&#x2F;Sv48</li></ul></li></ul><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://riscv.org/wp-content/uploads/2019/12/riscv-spec-20191213.pdf">The RISC-V Instruction Set Manual https://riscv.org/wp-content/uploads/2019/12/riscv-spec-20191213.pdf</a></li><li><a href="http://staff.ustc.edu.cn/~llxx/cod/reference_books/RISC-V-Reader-Chinese-v2p12017.pdf">RISC-V å¼€æºæŒ‡ä»¤é›†æ‰‹å†Œ æ±‰åŒ–ç‰ˆ ä¸­å›½ç§‘å­¦é™¢ http://staff.ustc.edu.cn/~llxx&#x2F;cod&#x2F;reference_books&#x2F;RISC-V-Reader-Chinese-v2p12017.pdf</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> RISCV </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Neural Network Pipeline</title>
      <link href="/2024/06/24/Neural-Network-Pipeline/"/>
      <url>/2024/06/24/Neural-Network-Pipeline/</url>
      
        <content type="html"><![CDATA[<pre><code class="python"># load necessary librariesimport torchimport torchvisionfrom torch import nnfrom torch.utils.data import DataLoaderfrom torchvision import datasetsfrom torchvision.transforms import ToTensor, Lambda, Composeimport matplotlib.pyplot as pltfrom time import time# print(torch.__version__)# print(torchvision.__version__)</code></pre><p>The Dataset used in this tutorial</p><p><code>Fashion-MNIST</code> is a dataset of Zalandoâ€™s article images consisting of of 60,000 training examples and 10,000 test examples. Each example comprises a 28Ã—28 grayscale image and an associated label from one of 10 classes.</p><pre><code class="python"># download FashionMNIST datasettraining_data = datasets.FashionMNIST(    root=&quot;data&quot;,    train=True,    download=True,    transform=ToTensor() # ToTensor() transforms the data to tensor type and rescale [0,255] uint8 to [0,1] float)# Download test data from open datasets.test_data = datasets.FashionMNIST(    root=&quot;data&quot;,    train=False,    download=True,    transform=ToTensor())# print(dir(training_data)) # print all attribute of an object# print(training_data.data[0,:]) # print info of the first picture# plt.imshow(training_data.data[0,:], cmap=plt.get_cmap(&#39;gray&#39;)) # visualize the first picture</code></pre><h2 id="Step-1-Prepare-Data"><a href="#Step-1-Prepare-Data" class="headerlink" title="Step 1: Prepare Data"></a>Step 1: Prepare Data</h2><pre><code class="python">batch_size = 128# print(training_data.data[0,:])# Create data loaders.train_dataloader = DataLoader(training_data, batch_size=batch_size, shuffle=True)test_dataloader = DataLoader(test_data, batch_size=batch_size)# check the first batch of the datasetfor X, y in test_dataloader:    print(&quot;Shape of X [N, C, H, W]: &quot;, X.shape, X.dtype) #     print(&quot;Shape of y: &quot;, y.shape, y.dtype)    break    # N: number of data instance in a batch# C: channel, number of colors in a pixel here# [H, W]: Height and width of a picture</code></pre><pre><code class="txt">Shape of X [N, C, H, W]:  torch.Size([128, 1, 28, 28]) torch.float32Shape of y:  torch.Size([128]) torch.int64</code></pre><pre><code class="python"># visualize sample imagesnsamples=10classes_names = [&#39;T-shirt/top&#39;, &#39;Trouser&#39;, &#39;Pullover&#39;, &#39;Dress&#39;, &#39;Coat&#39;, &#39;Sandal&#39;,&#39;Shirt&#39;, &#39;Sneaker&#39;, &#39;Bag&#39;, &#39;Ankle boot&#39;]imgs, labels = next(iter(train_dataloader))fig=plt.figure(figsize=(20,5),facecolor=&#39;w&#39;)for i in range(nsamples):    ax = plt.subplot(1,nsamples, i+1)#     print(imgs[i, 0, :, :])    plt.imshow(imgs[i, 0, :, :], cmap=plt.get_cmap(&#39;gray&#39;))    ax.set_title(&quot;&#123;&#125;&quot;.format(classes_names[labels[i]]), fontsize=15)    ax.get_xaxis().set_visible(False)    ax.get_yaxis().set_visible(False)plt.show()</code></pre><img src="/2024/06/24/Neural-Network-Pipeline/Neural_Network_Pipeline.png" class><h2 id="Step-2-Define-Neural-Nets"><a href="#Step-2-Define-Neural-Nets" class="headerlink" title="Step 2: Define Neural Nets"></a>Step 2: Define Neural Nets</h2><pre><code class="python">class MyModel(nn.Module):    def __init__(self):        super(MyModel, self).__init__()        self.linear_relu_stack = nn.Sequential(            # This is how your layers are defined and stacked sequentially            nn.Flatten(), # given an image of size 28x28, it will be flattened to a vector of size 784 # reshape the input to 1D (a very long vector)            nn.Linear(784, 128), # 784Ã—128 parameters            nn.ReLU(), # if negative, it becomes 0            nn.Dropout(0.2),            nn.Linear(128, 10), # 128Ã—10 output 128 layers and 10 labels            nn.Sigmoid()         )    def forward(self, x):        y = self.linear_relu_stack(x)        return ymodel = MyModel()print(model)</code></pre><pre><code class="txt">MyModel(  (linear_relu_stack): Sequential(    (0): Flatten(start_dim=1, end_dim=-1)    (1): Linear(in_features=784, out_features=128, bias=True)    (2): ReLU()    (3): Dropout(p=0.2, inplace=False)    (4): Linear(in_features=128, out_features=10, bias=True)    (5): Sigmoid()  ))</code></pre><h2 id="Step-3-Define-loss-function-and-the-optimizer"><a href="#Step-3-Define-loss-function-and-the-optimizer" class="headerlink" title="Step 3: Define loss function and the optimizer"></a>Step 3: Define loss function and the optimizer</h2><pre><code class="python"># define a loss function you want to optimize loss_fn = nn.CrossEntropyLoss()# define an optimizeroptimizer = torch.optim.Adam(model.parameters()) # Adam: A Method for Stochastic Optimization</code></pre><h2 id="Step-4-Train-the-neural-nets"><a href="#Step-4-Train-the-neural-nets" class="headerlink" title="Step 4: Train the neural nets"></a>Step 4: Train the neural nets</h2><pre><code class="python"># epochs: how many times we would like to traverse the whole datasetepochs=5for i in range(epochs): # iterate over epochs    tic = time()    model.train()    train_loss=0    for j, (X, y) in enumerate(train_dataloader): # iterate over batches         # Compute prediction error        pred = model(X)        loss = loss_fn(pred, y)        train_loss += loss.item()        # Backpropagation        optimizer.zero_grad()        loss.backward()        optimizer.step()        # print learning process every 100 batches        if j % 100 == 0:            loss, current = loss.item(), j * len(X)            print(f&quot;epoch &#123;i&#125; batch &#123;j&#125; loss: &#123;loss/batch_size:&gt;7f&#125;&quot;)        train_time = time() - tic        # print test results after every epochs        with torch.no_grad():        model.eval()        test_loss=0        hit=0        for (X, y) in test_dataloader:            pred = model(X)            test_loss += loss_fn(pred, y).item()            hit += (pred.argmax(1) == y).sum().item()        print(f&quot;epoch &#123;i&#125; training time: &#123;train_time:&gt;3f&#125;s, train loss: &#123;train_loss/len(train_dataloader.dataset):&gt;7f&#125; test loss: &#123;test_loss/len(test_dataloader.dataset):&gt;7f&#125; accuracy: &#123;hit/len(test_dataloader.dataset) :&gt;7f&#125;&quot;)    </code></pre><pre><code class="txt">epoch 0 batch 0 loss: 0.017987epoch 0 batch 100 loss: 0.013263epoch 0 batch 200 loss: 0.013020epoch 0 batch 300 loss: 0.013196epoch 0 batch 400 loss: 0.012888epoch 0 training time: 3.524010s, train loss: 0.013305 test loss: 0.012916 accuracy: 0.587600epoch 1 batch 0 loss: 0.012708epoch 1 batch 100 loss: 0.012738epoch 1 batch 200 loss: 0.012615epoch 1 batch 300 loss: 0.012646epoch 1 batch 400 loss: 0.012460epoch 1 training time: 3.451036s, train loss: 0.012682 test loss: 0.012763 accuracy: 0.617100epoch 2 batch 0 loss: 0.012583epoch 2 batch 100 loss: 0.012776epoch 2 batch 200 loss: 0.012628epoch 2 batch 300 loss: 0.012702epoch 2 batch 400 loss: 0.012469epoch 2 training time: 3.448095s, train loss: 0.012553 test loss: 0.012686 accuracy: 0.642400epoch 3 batch 0 loss: 0.012615epoch 3 batch 100 loss: 0.012434epoch 3 batch 200 loss: 0.012553epoch 3 batch 300 loss: 0.012463epoch 3 batch 400 loss: 0.012621epoch 3 training time: 3.463367s, train loss: 0.012486 test loss: 0.012625 accuracy: 0.650900epoch 4 batch 0 loss: 0.012159...epoch 4 batch 200 loss: 0.012609epoch 4 batch 300 loss: 0.012223epoch 4 batch 400 loss: 0.012312epoch 4 training time: 3.480916s, train loss: 0.012431 test loss: 0.012592 accuracy: 0.666100</code></pre><h2 id="Try-Different-Network-Structure"><a href="#Try-Different-Network-Structure" class="headerlink" title="Try Different Network Structure"></a>Try Different Network Structure</h2><ul><li>linear model with NO hidden layer, No dropout, No non-linearity activation</li></ul><pre><code class="python">class ShallowModel(nn.Module):    def __init__(self):        super(ShallowModel, self).__init__()        self.linear_stack = nn.Sequential(            nn.Flatten(),            nn.Linear(28*28, 10),            nn.Sigmoid()        )    def forward(self, x):        y = self.linear_stack(x)        return y    model = ShallowModel()print(model)# define a loss function you want to optimize loss_fn = nn.CrossEntropyLoss()# define an optimizeroptimizer = torch.optim.Adam(model.parameters()) </code></pre><ul><li>two hidden layers with 128 neurons and 32 neurons<ul><li>Activation Relu</li><li>Dropout 0.2</li></ul></li></ul><pre><code class="python">class DeepModel(nn.Module):    def __init__(self):        super(DeepModel, self).__init__()        self.linear_relu_stack = nn.Sequential(            nn.Flatten(),            nn.Linear(28*28, 128),            nn.ReLU(),            nn.Dropout(0.2),            nn.Linear(128, 32),            nn.ReLU(),            nn.Dropout(0.2),            nn.Linear(32, 10),            nn.Sigmoid()        )    def forward(self, x):        y = self.linear_relu_stack(x)        return ymodel = DeepModel()print(model)</code></pre>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SVD</title>
      <link href="/2024/05/04/svd/"/>
      <url>/2024/05/04/svd/</url>
      
        <content type="html"><![CDATA[<p>Problem: Decompose the matrix $\mathrm{A}&#x3D;\begin{pmatrix}5&amp;3 \\ 0&amp;-4\end{pmatrix}$ using Singular Value Decomposition(SVD). Please show detail calculation steps.</p><p><strong>Step1:</strong> calculate $AA^T$ and $A^TA$</p><p>$$A &#x3D; \begin{pmatrix}5&amp;3 \\ 0&amp;-4\end{pmatrix}, \text{then } A^T &#x3D; \begin{pmatrix}5&amp;0 \\ 3&amp;-4\end{pmatrix}$$</p><p>$$AA^T &#x3D; \begin{pmatrix}5&amp;3 \\ 0&amp;-4\end{pmatrix}\begin{pmatrix}5&amp;0 \\ 3&amp;-4\end{pmatrix} &#x3D; \begin{pmatrix}34&amp;-12 \\ -12&amp;-16\end{pmatrix}$$</p><p>$$A^TA &#x3D; \begin{pmatrix}5&amp;0 \\ 3&amp;-4\end{pmatrix}\begin{pmatrix}5&amp;3 \\ 0&amp;-4\end{pmatrix} &#x3D; \begin{pmatrix}25&amp;15 \\ 15&amp;25\end{pmatrix}$$</p><p><strong>Step2:</strong> calculate $\lambda_1, \lambda_2$ and $S$</p><p>$$\begin{aligned}<br>|AA^{T}-\lambda E|&#x3D;0<br>    &amp;\Rightarrow<br>    \left|\left(\begin{matrix}{34}&amp;{-12} \\ {-12}&amp;{16} \end{matrix}\right)-\lambda\left(\begin{matrix}{1}&amp;{0} \\ {0}&amp;{1} \end{matrix}\right)\right|&#x3D;0<br>\end{aligned}$$</p><p>$$\Rightarrow<br>\left|\begin{matrix}{34-\lambda}&amp;{-12} \\ {-12}&amp;{16-\lambda} \end{matrix}\right|&#x3D;0\Rightarrow(34-\lambda)(16-\lambda)-12\times12&#x3D;0<br>$$</p><p>$$\Rightarrow<br>\lambda^{2}-50\lambda+400&#x3D;0\Rightarrow(\lambda-40)(\lambda-10)&#x3D;0<br>$$</p><p>Eigenvalues: $\lambda_1&#x3D;40, \lambda_2&#x3D;10$</p><p>Singular values: $\sigma_1&#x3D;\sqrt{\lambda_1}&#x3D;\sqrt{40}&#x3D;2\sqrt{10},\sigma_2&#x3D;\sqrt{\lambda_2}&#x3D;\sqrt{10}$</p><p>Diagonal matrix S:  $S&#x3D;\begin{pmatrix}\sigma_1&amp;0 \\ 0&amp;\sigma_1\end{pmatrix}&#x3D;\begin{pmatrix}2\sqrt{10}&amp;0 \\ 0&amp;\sqrt{10}\end{pmatrix}$</p><p><strong>Step3:</strong> Finding $U$ $(AA^{T}-\lambda E)x&#x3D;0\Rightarrow U&#x3D;(u_{1},u_{2})&#x3D;\begin{pmatrix}-\frac{2}{\sqrt{5}}&amp;\frac{1}{\sqrt{5}} \\ \frac{1}{\sqrt{5}}&amp;\frac{2}{\sqrt{5}}\end{pmatrix}$</p><p>$$\begin{aligned}<br>For~\lambda_{1}&amp;&#x3D;40,<br>(AA^{T}-\lambda_{1}E)x_{1}&#x3D;0<br>\Rightarrow<br>\left(\left(\begin{matrix}{34}&amp;{-12} \\ {-12}&amp;{16} \end{matrix}\right)-40\left(\begin{matrix}{1}&amp;{0} \\ {0}&amp;{1} \end{matrix}\right)\right)x_1&#x3D;0<br>&amp;\end{aligned}<br>$$</p><p>$$\Rightarrow<br>\left(\begin{matrix}{-6}&amp;{-12} \\ {-12}&amp;{-24} \end{matrix}\right)x_1&#x3D;0<br>\Rightarrow<br>x_{1}&#x3D;\binom{-2a}{a}\Longrightarrow u_{1}&#x3D;\frac{x_{1}}{||x_{1}||}&#x3D;\begin{pmatrix}-\frac{2}{\sqrt{5}} \\ \frac{1}{\sqrt{5}}\end{pmatrix}<br>$$</p><p>$$\begin{aligned}<br>For~\lambda_{2}&amp;&#x3D;10,<br>(AA^{T}-\lambda_{2}E)x_{2}&#x3D;0<br>\Rightarrow<br>\left(\left(\begin{matrix}{34}&amp;{-12} \\ {-12}&amp;{16} \end{matrix}\right)-10\left(\begin{matrix}{1}&amp;{0} \\ {0}&amp;{1} \end{matrix}\right)\right)x_2&#x3D;0<br>\end{aligned}<br>$$</p><p>$$<br>\Rightarrow<br>\left(\begin{matrix}{24}&amp;{-12} \\ {-12}&amp;{6} \end{matrix}\right)x_2&#x3D;0<br>\Rightarrow<br>x_{2}&#x3D;\binom{a}{2a}\Longrightarrow u_{2}&#x3D;\frac{x_{2}}{||x_{2}||}&#x3D;\begin{pmatrix}\frac{1}{\sqrt{5}} \\ \frac{2}{\sqrt{5}}\end{pmatrix}<br>$$</p><p><strong>Step4:</strong> Finding $V$ $(AA^{T}-\lambda E)x&#x3D;0\Rightarrow V&#x3D;(v_{1},v_{2})&#x3D;\begin{pmatrix}\frac{1}{\sqrt{2}}&amp;\frac{1}{\sqrt{2}} \\ \frac{1}{\sqrt{2}}&amp;-\frac{1}{\sqrt{2}}\end{pmatrix}$</p><p>$$\begin{aligned}<br>For~\lambda_{1}&amp;&#x3D;40,<br>(AA^{T}-\lambda_{1}E)x_{3}&#x3D;0<br>\Rightarrow<br>\left(\left(\begin{matrix}{25}&amp;{15} \\ {15}&amp;{25} \end{matrix}\right)-40\left(\begin{matrix}{1}&amp;{0} \\ {0}&amp;{1} \end{matrix}\right)\right)x_3&#x3D;0<br>\end{aligned}<br>$$</p><p>$$<br>\Rightarrow<br>\left(\begin{matrix}{-15}&amp;{15} \\ {15}&amp;{-15} \end{matrix}\right)x_3 &#x3D;0<br>\Rightarrow<br>x_{3}&#x3D;\binom{c}{c}\Longrightarrow v_{1}&#x3D;\frac{x_{3}}{||x_{3}||}&#x3D;\begin{pmatrix}\frac{1}{\sqrt{2}} \\ \frac{1}{\sqrt{2}}\end{pmatrix}<br>$$</p><p>$$\begin{aligned}<br>For~\lambda_{2}&amp;&#x3D;10,<br>(AA^{T}-\lambda_{2}E)x_{4}&#x3D;0<br>\Rightarrow<br>\left(\left(\begin{matrix}{25}&amp;{15} \\ {15}&amp;{25}  \end{matrix}\right)-10\left(\begin{matrix}{1}&amp;{0} \\ {0}&amp;{1} \end{matrix}\right)\right)x_4&#x3D;0<br>\end{aligned}<br>$$</p><p>$$<br>\Rightarrow<br>\left(\begin{matrix}{15}&amp;{15} \\ {15}&amp;{15} \end{matrix}\right)x_4&#x3D;0<br>\Rightarrow<br>x_{4}&#x3D;\binom{d}{-d}\Longrightarrow v_{2}&#x3D;\frac{x_{4}}{||x_{4}||}&#x3D;\begin{pmatrix}\frac{1}{\sqrt{2}} \\ -\frac{1}{\sqrt{2}}\end{pmatrix}<br>$$</p><p><strong>Step5:</strong> Complete SVD</p><p>$$<br>\left(\begin{matrix}{5}&amp;{3} \\ {0}&amp;{-4} \end{matrix}\right) &#x3D;<br>\left(\begin{matrix}{-\frac{2}{\sqrt{5}}}&amp;{\frac{1}{\sqrt{5}}} \\ {\frac{1}{\sqrt{5}}}&amp;{\frac{2}{\sqrt{5}}} \end{matrix}\right)<br>\left(\begin{matrix}{2\sqrt{10}}&amp;{0} \\ {0}&amp;{\sqrt{10}} \end{matrix}\right)<br>\left(\begin{matrix}{\frac{1}{\sqrt{2}}}&amp;{\frac{1}{\sqrt{2}}} \\ {\frac{1}{\sqrt{2}}}&amp;{-\frac{1}{\sqrt{2}}} \end{matrix}\right)<br>$$</p>]]></content>
      
      
      <categories>
          
          <category> math </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pattern recognition </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PR-ch04-NLC</title>
      <link href="/2024/05/04/PR-ch04-NLC/"/>
      <url>/2024/05/04/PR-ch04-NLC/</url>
      
        <content type="html"><![CDATA[<img src="/2024/05/04/PR-ch04-NLC/problem.png" class><hr><p>Solution:</p><img src="/2024/05/04/PR-ch04-NLC/1.png" class><img src="/2024/05/04/PR-ch04-NLC/2.png" class><img src="/2024/05/04/PR-ch04-NLC/3.png" class><img src="/2024/05/04/PR-ch04-NLC/4.png" class><img src="/2024/05/04/PR-ch04-NLC/5.png" class><img src="/2024/05/04/PR-ch04-NLC/6.png" class><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><img src="/2024/05/04/PR-ch04-NLC/cover.png" class><ul><li>Sergios Theodoridis Konstantinos Koutroumbas Pattern Recognition. 4th Edition. Springer, 2010.</li></ul>]]></content>
      
      
      <categories>
          
          <category> math </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pattern recognition </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PR-ch03-LC</title>
      <link href="/2024/05/04/PR-ch03-LC/"/>
      <url>/2024/05/04/PR-ch03-LC/</url>
      
        <content type="html"><![CDATA[<p>Decision hyperplane:</p><p>$$g(x)&#x3D;w^{T}x+w_{0}&#x3D;0\Rightarrow w_{1}x_{1}+w_{2}x_{2}+\cdots+w_{l}x_{l}+w_{0}&#x3D;0$$</p><p>where $w&#x3D;(w_{1},w_{2},â€¦,w_{l})^{T}$ is weight vector, $w_{0}$ is threshold</p><p><strong>Our goal:</strong> compute a solution, a hyperplane $w$, so that</p><p>$$w^Tx+w_0&gt;0(or&lt;0),\quad x\in\omega_1(or \omega_2)$$</p><p>Perceptron algorithmï¼š</p><ul><li>Define a cost function $J(w)$</li><li>Chooses an algorithm to minimize $J(w)$</li><li>The minimum corresponds to a solution</li></ul><p><strong>Perceptron cost functionï¼š</strong></p><p>$$J(w)&#x3D;\sum_{x\in Y}\delta_xw^Tx$$</p><ul><li>Y is the subset of the training vectors wrongly classified by $w$</li><li>When ğ‘Œ &#x3D; âˆ…, a solution is achieved and  $J(w) â‰¥ 0$</li><li>$\delta_x&#x3D;\begin{cases}-1&amp; \text{if}x\in\omega_1 \\ +1&amp; \text{if}x\in\omega_2\end{cases}$</li><li>$J(w)$ is continuous and piecewise linear</li></ul><p><strong>Minimize the cost function:</strong></p><p>$$\frac{\partial J(w)}{\partial w}&#x3D;\frac{\partial}{\partial w}\left(\sum_{x\in Y}(\delta_{x}w^{T}x)\right)&#x3D;\sum_{x\in Y}\delta_{x}x$$</p><p>$$w(t+1)&#x3D;w(t)-\rho_t\frac{\partial J(w)}{\partial w}\Bigg|_{w&#x3D;w(t)}$$</p><p>$$w(t+1)&#x3D;w(t)-\rho_t\sum_{x\in Y}\delta_xx$$</p><p>The perceptron algorithm converges in a finite number of iteration steps<br>to a solution if</p><p>$$\lim_{t\to\infty}\sum_{k&#x3D;0}^t\rho_k\to\infty\quad\mathrm{and}\quad\lim_{t\to\infty}\sum_{k&#x3D;0}^t\rho_k^2&lt;+\infty $$</p><p>The perceptron algorithm is a reward and punishment scheme</p><hr><img src="/2024/05/04/PR-ch03-LC/problem.png" class><hr><p>Solution:</p><img src="/2024/05/04/PR-ch03-LC/1.png" class><img src="/2024/05/04/PR-ch03-LC/2.png" class><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><img src="/2024/05/04/PR-ch03-LC/cover.png" class><ul><li>Sergios Theodoridis Konstantinos Koutroumbas Pattern Recognition. 4th Edition. Springer, 2010.</li></ul>]]></content>
      
      
      <categories>
          
          <category> math </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pattern recognition </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PR-ch02-Bayes</title>
      <link href="/2024/04/30/PR-ch02-Bayes/"/>
      <url>/2024/04/30/PR-ch02-Bayes/</url>
      
        <content type="html"><![CDATA[<hr><p><strong>Problem 2.2:</strong> In a two-class one-dimensional problem, the pdfs are the Gaussians $\mathcal{N}(0,\sigma^2)$ and $\mathcal{N}(1,\sigma^2)$ for the two classes, respectively. Show that the threshold $x_0$ minimizing the average risk is equal to<br>$$x_0&#x3D;1&#x2F;2-\sigma^2\ln\frac{\lambda_{21}P(\omega_2)}{\lambda_{12}P(\omega_1)}$$<br>where $\lambda_{11}&#x3D;\lambda_{22}&#x3D;0$ has been assumed.</p><hr><p>Solution: In a two-class problem:</p><p>$$R(\alpha_1|x)&#x3D;\lambda_{11}P(\omega_1|x)+\lambda_{12}P(\omega_2|x)$$</p><p>$$R(\alpha_2|x)&#x3D;\lambda_{21}P(\omega_1|x)+\lambda_{22}P(\omega_2|x)$$</p><p>The threshold $x_0$ minimizing the average risk where $R(\alpha_1|x_0)&#x3D;R(\alpha_2|x_0),$ then:</p><p>$$\lambda_{11}P(\omega_1|x_0)+\lambda_{21}P(\omega_2|x_0)&#x3D;\lambda_{12}P(\omega_1|x_0)+\lambda_{22}P(\omega_2|x_0)$$</p><p>$$\Rightarrow\frac{P(\omega_1|x_0)}{P(\omega_2|x_0)}&#x3D;\frac{p(x_0|\omega_1)P(\omega_1)}{p(x_0|\omega_2)P(\omega_2)}&#x3D;\frac{\lambda_{12}-\lambda_{22}}{\lambda_{21}-\lambda_{11}}$$</p><p>To minimize the average risk, we have<br>$$\frac{P(x_0|\omega_1)}{P(x_0|\omega_2)}&#x3D;\frac{\lambda_{12}-\lambda_{22}}{\lambda_{21}-\lambda_{11}}\frac{P(\omega_2)}{P(\omega_1)}$$<br>and $\lambda_{11}&#x3D;\lambda_{22}&#x3D;0$,then</p><p>$$\frac{P(x_0|\omega_1)}{P(x_0|\omega_2)}&#x3D;\frac{\lambda_{12}}{\lambda_{21}}\frac{P(\omega_2)}{P(\omega_1)}$$</p><p>taking the logarithm of both sides,$$lnP(x_{0}|\omega_{1})-lnP(x_{0}|\omega_{2})&#x3D;ln\frac{\lambda_{12}P(\omega_{2})}{\lambda_{21}P(\omega_{1})}$$</p><p>since $P(x_{0}|\omega_{1}){\sim}N(0,\sigma^{2}),$</p><p>$$P(x_{0}|\omega_{1})&#x3D;\frac{1}{\sqrt{2\pi}\sigma}e^{-\frac{x_{0}^{2}}{2\sigma^{2}}}\quad\Rightarrow{lnP(x_{0}|\omega_{1})}&#x3D;-ln(\sqrt{2\pi}\sigma)-\frac{x_{0}^{2}}{2\sigma^{2}}$$</p><p>and $P(x_{0}|\omega_{2}){\sim}N(1,\sigma^{2}),$</p><p>$$P(x_{0}|\omega_{2})&#x3D;\frac{1}{\sqrt{2\pi}\sigma}e^{-\frac{(x_{0}-1)^{2}}{2\sigma^{2}}}\quad\Rightarrow{lnP(x_{0}|\omega_{2})}&#x3D;-ln(\sqrt{2\pi}\sigma)-\frac{(x_{0}-1)^{2}}{2\sigma^{2}}$$</p><p>then, $lnP(x_0|\omega_1)-lnP(x_0|\omega_2)&#x3D;-ln(\sqrt{2\pi}\sigma)-\frac{x_0^2}{2\sigma^2}-(-ln(\sqrt{2\pi}\sigma)-\frac{(x_0-1)^2}{2\sigma^2})$</p><p>$$lnP(x_0|\omega_1)-lnP(x_0|\omega_2)&#x3D;-\frac{(x_0-1)^2}{2\sigma^2}-\frac{x_0^2}{2\sigma^2}&#x3D;ln\frac{\lambda_{12}P(\omega_2)}{\lambda_{21}P(\omega_1)}$$</p><p>$$(x_{0}-1)^{2}-x_{0}^{2}&#x3D;2\sigma^{2}ln\frac{\lambda_{12}P(\omega_{2})}{\lambda_{21}P(\omega_{1})}$$</p><p>$$x_{0}^{2}-2x_{0}+1-x_{0}^{2}&#x3D;2\sigma^{2}ln\frac{\lambda_{12}P(\omega_{2})}{\lambda_{21}P(\omega_{1})}$$</p><p>$$-2x_{0}+1&#x3D;2\sigma^{2}ln\frac{\lambda_{12}P(\omega_{2})}{\lambda_{21}P(\omega_{1})}$$</p><p>$$\mathrm{thus},\quad x_0&#x3D;\frac{1}{2}-\sigma^2ln\frac{\lambda_{12}P(\omega_2)}{\lambda_{21}P(\omega_1)}$$</p><hr><p><strong>Problem 2.5:</strong> Consider a two (equiprobable) class, one-dimensional problem with samples distributed according to the Rayleigh pdf in each class, that is,<br>$$p(x|\omega_i)&#x3D;\begin{cases}\frac{x}{\sigma_i^2}\exp\left(\frac{-x^2}{2\sigma_i^2}\right)&amp;x\geq0 \\ 0&amp;x&lt;0\end{cases}$$<br>Compute the decision boundary point $g(x)&#x3D;0.$</p><hr><p>Solution: The decision boundary point corresponds to</p><p>$$\frac{x_0}{\sigma_1^2}\exp(\frac{-x_0^2}{2\sigma_1^2})&#x3D;\frac{x_0}{\sigma_2^2}\exp(\frac{-x_0^2}{2\sigma_2^2})$$</p><p>or by taking the logarithm</p><p>$$\frac{-x_0^2}{2\sigma_1^2}&#x3D;\ln\frac{\sigma_1^2}{\sigma_2^2}-\frac{x_0^2}{2\sigma_2^2}$$</p><p>and finally</p><p>$$x_0&#x3D;\sqrt{\frac{2\sigma_1^2\sigma_2^2}{\sigma_1^2-\sigma_2^2}\ln\frac{\sigma_1^2}{\sigma_2^2}}$$</p><hr><p><strong>Problem 2.7:</strong> In a three-class,two-dimensional problem the feature vectors in each class are normally distributed with covariance matrix<br>$$\Sigma&#x3D;\begin{bmatrix}1.2&amp;0.4 \\ 0.4&amp;1.8\end{bmatrix}$$<br>The mean vectors for each class are $[0.1,0.1]^T,[2.1,1.9]^T,[-1.5,2.0]^T.$ Assuming that the classes are equiprobable,<br>(a) classify the feature vector [1.6,1.5]$^T$ according to the Bayes minimum error probability classifier;<br>(b) draw the curves of equal Mahalanobis distance from [2.1,1.9]$^{\acute{T}}.$</p><hr><p>Solution: </p><p>(a) It suffices to compute the Mahalanobis distance of $[1.6,1.5]^T$ from mean vectors of the classes. We have:</p><p>$$\Sigma^{-1}&#x3D;\left[\begin{array}{cc}0.9&amp;0.2 \\ -0.2&amp;0.6\end{array}\right]$$</p><p>$$|\Sigma|&#x3D;1.2\times1.8-0.4\times0.4&#x3D;2,\Sigma^{-1}&#x3D;\frac{1}{|\Sigma|}\Big[\begin{matrix}1.8&amp;-0.4 \\ -0.4&amp;1.2\end{matrix}\Big]&#x3D;\Big[\begin{matrix}0.9&amp;-0.2 \\ -0.2&amp;0.6\end{matrix}\Big]$$</p><p>Thus, $d_1^2&#x3D;2.361,d_2^2&#x3D;0.241,d_3^2&#x3D;9.416$</p><p>Hence $[1.6,1.5]^T$ is assigned to $\mathcal{w_2}$</p><p>(b) According to theory it suffices to compute the eigenvalues and eigenvectors of $\Sigma$. There are </p><p>$$\lambda_{1}&#x3D;1,\lambda_{2}&#x3D;2 \\ v_{1}&#x3D;[0.89,-0.45]^{T} \\ v_{2}&#x3D;[0.45,0.89]^{T}$$</p><p>Thus the ellipse, centered at $\mu_2$ and axis</p><p>$2\sqrt{\lambda_1}c\boldsymbol{v}_1$ and $2\sqrt{\lambda_2}c\boldsymbol{v}_2$</p><hr><p><strong>Problem 2.12:</strong> Consider a two-class, two-dimensional classification task, where the feature vectors in each of the classes $\omega_1,\omega_{2}$ are distributed according to</p><p>$$p(x|\omega_1)&#x3D;\frac{1}{\sqrt{2\pi\sigma_1^2}}\exp\biggl(-\frac{1}{2\sigma_1^2}(x-\mu_1)^T(x-\mu_1)\biggr)$$</p><p>$$p(x|\omega_2)&#x3D;\dfrac{1}{\sqrt{2\pi\sigma_2^2}}\exp\biggl(-\dfrac{1}{2\sigma_2^2}(x-\mu_2)^T(x-\mu_2)\biggr)$$</p><p>with</p><p>$$\mu_{1}&#x3D;[1,1]^{T},\mu_{2}&#x3D;[1.5,1.5]^{T},\sigma_{1}^{2}&#x3D;\sigma_{2}^{2}&#x3D;0.2$$</p><p>Assume that $P(\omega_1)&#x3D;P(\omega_2)$ and design a Bayesian classifier<br>(a) that minimizes the error probability<br>(b) that minimizes the average risk with loss matrix</p><p>$$\Lambda&#x3D;\begin{bmatrix}0&amp;1 \\ 0.5&amp;0\end{bmatrix}$$</p><p>Using a pseudorandom number generator, produce 100 feature vectors from each class, according to the preceding pdfs. Use the classifiers designed to classify the generated vectors. What is the percentage error for each case? Repeat the experiments for $\mu_{2}&#x3D;[3.0,3.0]^{T}.$</p><hr><p>Solution:</p><p>(a) For the two-class classification, if $P(\omega_1)&#x3D;P(\omega_2)$ and $\lambda_{11}&#x3D;\lambda_{22}&#x3D;0$,</p><p>The Bayesian classifier is: $x\to\omega_{1}$ if $P(x|\omega_{1})&gt;P(x|\omega_{2})\frac{\lambda_{12}}{\lambda_{21}}$</p><p>If $\lambda_{12}&#x3D;\lambda_{21}$ , the Bayesian classifier minimizes the error probability. Thus, the Bayesian<br>classifier is: $x\to\omega_{1}$ if $P(x|\omega_{1})&gt;P(x|\omega_{2})$</p><p>We have</p><p>$$p(x|\omega_1)&#x3D;\frac{1}{\sqrt{2\pi\sigma_1^2}}\exp\biggl(-\frac{1}{2\sigma_1^2}(x-\mu_1)^T(x-\mu_1)\biggr)$$</p><p>$$p(x|\omega_2)&#x3D;\dfrac{1}{\sqrt{2\pi\sigma_2^2}}\exp\biggl(-\dfrac{1}{2\sigma_2^2}(x-\mu_2)^T(x-\mu_2)\biggr)$$</p><p>From $\sigma_1^2&#x3D;\sigma_2^2&#x3D;\sigma^2,|x-\mu_1|^2&#x3D;(x-\mu_1)^T(x-\mu_1)$ and $|x-\mu_2|^2&#x3D;(x-\mu_2)^T(x-\mu_2)$, we have</p><p>$$P(x|\omega_1)&#x3D;\frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(-\frac{|x-\mu_1|^2}{2\sigma^2}\right),\quad P(x|\omega_2)&#x3D;\frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(-\frac{|x-\mu_2|^2}{2\sigma^2}\right)$$</p><p>$P(x|\omega_1)&gt;P(x|\omega_2)$ is equivalent to $\ln P(x|\omega_1)&gt;\ln P(x|\omega_2)$</p><p>$$\ln P(x|\omega_1)&#x3D;\ln\frac{1}{\sqrt{2\pi\sigma^2}}-\frac{|x-\mu_1|^2}{2\sigma^2},\quad\ln P(x|\omega_2)&#x3D;\ln\frac{1}{\sqrt{2\pi\sigma^2}}-\frac{|x-\mu_2|^2}{2\sigma^2}$$</p><p>$P(x|\omega_1)&gt;P(x|\omega_2)$ is equivalent to $|x-\mu_1|&lt;|x-\mu_2|$</p><p>Thus, for the Bayesian classifier minimizing the error probability is equivalent to the<br>classifier minimizing the Euclidean distance, namely,</p><p>$$x\to\omega_1\text{ if }|x-\mu_1|&lt;|x-\mu_2|$$</p><p>(b) In this case, $x$ is classified to $P(x|\omega_{1})&gt;P(x|\omega_{2})\frac{\lambda_{12}}{\lambda_{21}}$</p><p>where $\lambda_{12}&#x3D;1$ and $\lambda_{21}&#x3D;0.5$. Thus following similar arguments as in theory, for Bayesian<br>classification for normal distributions, we conclude that the decision hyperplane is</p><p>$$g_{12}(x)&#x3D;w^T(x-x_0) \\ w&#x3D;\mu_{1}-\mu_{2}$$</p><p>and</p><p>$$x_0&#x3D;\frac{1}{2}(\mu_1+\mu_2)-\sigma^2\ln\frac{\lambda_{21}P(\omega_1)}{\lambda_{12}P(\omega_2)}\frac{\mu_1-\mu_2}{|\mu_1-\mu_2|^2}$$</p><p>(c) The following MATLAB function takes as input the variance (s), the mean ( m) and the number of samples N. The output is a vector 1xN, whose ele- ments are the N samples of the 1-D Gaussian. For 2-D independent variables, combine two samples generated above, in a single vector</p><p>$$x&#x3D;[x_1,x_2]^T$$</p><pre><code class="matlab">Function x=gaussian(m,s,N);x=randn(1,N);x=x*sqrt(s)+m;</code></pre><hr><p><strong>Problem 2.17ï¼š</strong> In a heads or tails coin-tossing experiment the probability of occurrence of a head (1) is $q$ and that of a tail (0) is $1-q$. Let $x_i,i &#x3D;1,2,â€¦,N$, be the resulting experimental outcomes, ğ‘¥ğ‘– âˆˆ {0,1}. Show that the ML estimate of $q$ is</p><p>$$q_{ML}&#x3D;\frac1N\sum_{i&#x3D;1}^Nx_i$$</p><p>Hint: The likelihood function is</p><p>$$P(X;q)&#x3D;\prod_{i&#x3D;1}^Nq^{x_i}(1-q)^{(1-x_i)}$$</p><p>Then show that the ML results from the solution of the equation</p><p>$$q^{\sum_{i}x_{i}}(1-q)^{(N-\sum_{i}x_{i})}\left(\frac{\sum_{i}x_{i}}{q}-\frac{N-\sum_{i}x_{i}}{1-q}\right)&#x3D;0$$</p><hr><p>Solution:</p><img src="/2024/04/30/PR-ch02-Bayes/6.png" class><img src="/2024/04/30/PR-ch02-Bayes/7.png" class><hr><p><strong>Problem 2.29ï¼š</strong> Show that for the lognormal distribution</p><p>$$p(x)&#x3D;\frac{1}{\sigma x\sqrt{2\pi}}\exp\left(-\frac{(\ln{x}-\theta)^{2}}{2\sigma^{2}}\right),x&gt;0$$</p><p>The ML estimate is given by</p><p>$$\theta_{ML}&#x3D;\frac{1}{N}\sum_{k&#x3D;1}^{N}\ln{x_k}$$</p><hr><p>Solution:</p><img src="/2024/04/30/PR-ch02-Bayes/8.png" class><hr><p><strong>Problem:</strong> Consider two normal distributions in one dimension: $N(\mu_1,\sigma_1^2)$ and $N(\mu_2,\sigma_2^2).$ Imagine that we choose two random samples $x_1$ and $x_2$,one from each of the normal distributions and calculate their sum $x_3&#x3D;x_1+x_2.$ Suppose we do this repeatedly.</p><p>(a) Consider the resulting distribution of the values of $x_3.$ Show from frst principles<br>that this is also a normal distribution.</p><p>(b) What is the mean,  $\mu_{3}$, of your new distribution?</p><p>(c) What is the variance, $\sigma_3^2?$</p><p>(d) Repeat the above with two distributions in a multi-dimensional space, i.e., $N(\mu_1,\Sigma_1)$ and $N(\mu_2,\Sigma_2).$</p><hr><p>Solution:</p><img src="/2024/04/30/PR-ch02-Bayes/1.png" class><img src="/2024/04/30/PR-ch02-Bayes/2.png" class><img src="/2024/04/30/PR-ch02-Bayes/3.png" class><img src="/2024/04/30/PR-ch02-Bayes/4.png" class><img src="/2024/04/30/PR-ch02-Bayes/5.png" class><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><img src="/2024/04/30/PR-ch02-Bayes/cover.png" class><ul><li>Sergios Theodoridis Konstantinos Koutroumbas Pattern Recognition. 4th Edition. Springer, 2010.</li></ul>]]></content>
      
      
      <categories>
          
          <category> math </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pattern recognition </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kmeans++</title>
      <link href="/2024/04/24/Kmeans/"/>
      <url>/2024/04/24/Kmeans/</url>
      
        <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In this notebook, we shall be looking at how the kmeans algorithm works. KMeans is an <strong>unsupervised learning</strong> algorithm that is used to cluster data in groups - without knowing which group given data elements belong to as are going to see.</p><pre><code class="python">import numpy as npimport sklearn.datasetsimport matplotlib.pyplot as pltimport matplotlib as mpl</code></pre><p>Letâ€™s shall generate a random dataset of 1000 points clustered into 3 groups.</p><pre><code class="python"># è®¾ç½®æ•°æ®é›†ä¸­æ ·æœ¬ç‚¹çš„æ•°é‡N = 1000# ç”Ÿæˆå…·æœ‰3ä¸ªä¸­å¿ƒç‚¹çš„èšç±»æ•°æ®é›†X_, y_ = sklearn.datasets.make_blobs(n_samples=N+5, centers=3) # ä»ç”Ÿæˆçš„æ•°æ®é›†ä¸­æå–å‰Nä¸ªæ ·æœ¬ä½œä¸ºè®­ç»ƒæ•°æ®X, y = X_[:N], y_[:N]# ä»ç”Ÿæˆçš„æ•°æ®é›†ä¸­æå–åé¢5ä¸ªæ ·æœ¬ä½œä¸ºæµ‹è¯•æ•°æ®X_test, y_test = X_[N:], y_[N:]# ç»˜åˆ¶æ•°æ®é›†çš„æ•£ç‚¹å›¾plt.figure(figsize=(8, 6))for cls in np.unique(y):    plt.scatter(X[y==cls][:, 0], X[y==cls][:, 1], s=2)plt.title(&quot;Plot of features of dataset X&quot;, fontsize=14)plt.xlabel(&quot;x1&quot;, fontsize=12)plt.ylabel(&quot;x2&quot;, fontsize=12)plt.show()</code></pre><!-- ![sampla dataset](./Kmeans/sample_dataset_X.png) --><img src="/2024/04/24/Kmeans/sample_dataset_X.png" class><h2 id="1-1-First-things-first"><a href="#1-1-First-things-first" class="headerlink" title="1.1 First things first"></a>1.1 First things first</h2><ol><li><p>We need to determine and set a value k, the number of clusters we <strong>think</strong> the data has. KMeans is unsupervised. So it is not the case that you will always know how many clusters (k) exist in the data. You will have to experiment with different values using certain techniques to find the best value of k. For our case, we know that there are 3 clusters, therefore we shall set k to 3. (You can try a different value after the points get clear).</p></li><li><p>We also need to <strong>find k&#x3D;3 random points</strong> that will represent the centers of our clusters if the clustering is successfull. These k random points are called centroids.Letâ€™s work on these two steps next.</p></li></ol><pre><code class="python">k = 3N, feature_size = X.shape# è·å–ç‰¹å¾çš„æœ€å¤§å€¼å’Œæœ€å°å€¼èŒƒå›´min_feature_range = np.min(X, axis=0)max_feature_range = np.max(X, axis=0)# åœ¨ä¸Šè¿°èŒƒå›´å†…ç”Ÿæˆkä¸ªéšæœºç‚¹centroids = np.zeros((len(max_feature_range), k))for i, (l, h) in enumerate(zip(min_feature_range, max_feature_range)):    # ä½¿ç”¨random.uniform()å‡½æ•°ä»å‡åŒ€åˆ†å¸ƒä¸­æŠ½å–æ ·æœ¬    centroids[i, :] = np.random.uniform(low=l, high=h, size=k)# è½¬ç½®centroidsçŸ©é˜µï¼Œä½¿å¾—æ¯è¡Œè¡¨ç¤ºä¸€ä¸ªèšç±»ä¸­å¿ƒcentroids = centroids.Tprint(centroids)# ç»˜åˆ¶æ•°æ®é›†çš„æ•£ç‚¹å›¾å’Œèšç±»ä¸­å¿ƒplt.figure(figsize=(8, 6))for cls in np.unique(y):    plt.scatter(X[y==cls][:, 0], X[y==cls][:, 1], s=2)# ç»˜åˆ¶èšç±»ä¸­å¿ƒfor i, (x_, y_) in enumerate(centroids):    plt.scatter(x_, y_, marker=&#39;x&#39;, c=&#39;k&#39;)    plt.annotate(xy=(x_+.1, y_-.1), text=&#39;c&#39;+str(i), color=&#39;r&#39;)plt.title(&quot;Plot of features of dataset X&quot;, fontsize=14)plt.xlabel(&quot;x1&quot;, fontsize=12)plt.ylabel(&quot;x2&quot;, fontsize=12)plt.show()</code></pre><!-- ![1.1](./Kmeans/1.1.png) --><img src="/2024/04/24/Kmeans/1.1.png" class><p>The points are scattered and may not be close to the cluster centers. There are other methods like the <strong>kmeans++</strong>.</p><h2 id="1-2-Calculate-distances-to-centroids"><a href="#1-2-Calculate-distances-to-centroids" class="headerlink" title="1.2 Calculate distances to centroids"></a>1.2 Calculate distances to centroids</h2><p>In this notebook, we shall be calculating the euclidean distance. We have 2 columns in X <em>(x1 and x2)</em> and we have to calculate the euclidean distance between each centroid and every data point in X. Centroids are of the form <em>(xx, yy)</em> i.e they have two points just like our dataset X has 2 columns.</p><p>è®¡ç®—æ¯ä¸ªè´¨å¿ƒå’Œ X ä¸­æ¯ä¸ªæ•°æ®ç‚¹ä¹‹é—´çš„æ¬§å‡ é‡Œå¾—è·ç¦»ã€‚</p><p>We want to calculate something of the form $sqrt((x1-xx)^2 + (x2-yy)^2)$ for each data point&#x2F;row in X.<br>To accelerate operations, we shall be using a vectorized approach to calculate that.</p><p>ä½¿ç”¨çŸ¢é‡åŒ–æ–¹æ³•æ¥è®¡ç®—ã€‚</p><ol><li>We have k&#x3D;3 centroids, so we shall first duplicate <strong>X</strong> 3 times or k times. The shape of X is (1000, 2). The result of the duplication, <strong>Xc</strong> will be (1000, 6).</li><li>Then we shall flatten the centroids so that its a single vector, <strong>centroidsc</strong> of 6 elements to match our 6 columns in <strong>Xc</strong>.</li><li>We shall subtract <strong>Xc</strong> and <strong>centroidsc</strong> to give us a result <strong>D</strong> of shape (1000, 6). This step is equivalent to performing <strong>(x1-xx)</strong> and <strong>(x2-yy)</strong> for all centroids at once.</li></ol><ul><li>The first column of <strong>D</strong> corresponds to <strong>(x1-xx)</strong> where xx is the x of the first centroid.</li><li>The second column of <strong>D</strong> corresponds to <strong>(x2-yy)</strong> where yy is the y of the first centroid.</li><li>The third column of <strong>D</strong> corresponds to <strong>(x1-xx)</strong> where xx is the x of the <em>second</em> centroid.</li><li>The forth column of <strong>D</strong> corresponds to <strong>(x2-yy)</strong> where yy is the y of the <em>second</em> centroid. And so on.</li></ul><p>4.The next step is to square these results, add them and apply sqrt. This whole operation results in what is called the <em>L2 norm</em> and is all performed by the <strong>np.linalg.norm</strong> function.</p><p>Note that we have to calculate the norm over a given set of columns e.g the first and second columnsâ€™ norm corresponds to the first centroid, the third and forth to the 2nd centroid and the last 2 to the 3rd centroid. So in the end we have a (1000, 3) array containing euclidean distances of each of the 1000 data rows&#x2F;points in X in correspondence to each of the 3 centroids.</p><pre><code class="python">Xc = np.concatenate([X for c in centroids], axis=1) # duplicate X k timescentroidsc = centroids.ravel() # ravel to allow broadcast; Return a contiguous flattened array.D = (Xc - centroidsc) # raw diffNorms = np.zeros((N, k)) # distances to each centroidfor i in range(0, k):     m = i*feature_size    Norms[:, i] = np.linalg.norm(D[:, m:m+feature_size], axis=1) # Calculating the norms (Euclidean distance)</code></pre><h2 id="1-3-Attach-instances-or-rows-to-the-closest-centroid"><a href="#1-3-Attach-instances-or-rows-to-the-closest-centroid" class="headerlink" title="1.3 Attach instances or rows to the closest centroid"></a>1.3 Attach instances or rows to the closest centroid</h2><p>We shall now assign each data row in X the index of the centroid with which it has the shortest distance. We do that using <strong>np.argmin</strong> which returns the index of the minimum distance in our <em>Norms</em> array.</p><p>ä½¿ç”¨ <strong>np.argmin</strong> æ¥ä¸º X ä¸­çš„æ¯ä¸ªæ•°æ®è¡Œåˆ†é…ä¸å…¶è·ç¦»æœ€çŸ­çš„è´¨å¿ƒçš„ç´¢å¼•ï¼Œå®ƒè¿”å› <em>Norms</em> æ•°ç»„ä¸­æœ€å°è·ç¦»çš„ç´¢å¼•ã€‚</p><pre><code class="python"># sample of indices for smallest indices for sample_normsnp.argmin(sample_norms, axis=1)# we do this for all Normsypred = np.argmin(Norms, axis=1) #Returns the indices of the minimum values along an axis.plt.figure(figsize=(8, 6))for i, (x_, y_) in enumerate(centroids):  # with underscore    p = plt.scatter(X[y==i][:, 0], X[y==i][:, 1], s=2)    clr = mpl.colors.to_rgba(p.get_facecolor()) # get color used by matplotlib    plt.scatter(x_, y_, marker=&#39;x&#39;, c=&#39;k&#39;)    anot = &#39;c&#39;+str(i) + &quot; at &quot; + str(np.round(Norms[0, i], 3))    plt.plot([X[0][0], x_], [X[0][1], y_])    plt.annotate(xy=(x_+.2, y_-.1), text=anot, color=&#39;k&#39;, size=10)    plt.scatter(X[0][0], X[0][1], marker=&#39;o&#39;, c=&#39;r&#39;, s=35)plt.title(&quot;Plot showing distance sample (point belongs to c&quot;+str(ypred[0])+&quot;)&quot;, fontsize=14)plt.xlabel(&quot;x1&quot;, fontsize=12)plt.ylabel(&quot;x2&quot;, fontsize=12)plt.show()</code></pre><!-- ![1.3](./Kmeans/1.3.png) --><img src="/2024/04/24/Kmeans/1.3.png" class><h2 id="1-4-Update-centroids"><a href="#1-4-Update-centroids" class="headerlink" title="1.4 Update centroids"></a>1.4 Update centroids</h2><p>The last step is to update the centroids by setting the new centroids at the mean positions of the points they were closest to i.e the data points they influence.</p><p>Below is a plot showing the un-updated centroids and their influence on the data points. We shall have to move the centroids so that they are at the center of the points they influence.</p><pre><code class="python">plt.figure(figsize=(8, 6))for i, (x_, y_) in enumerate(centroids):    p = plt.scatter(X[ypred==i][:, 0], X[ypred==i][:, 1], s=2)    clr = mpl.colors.to_rgba(p.get_facecolor()) # get color used by matplotlib    plt.scatter(x_, y_, marker=&#39;x&#39;, c=&#39;k&#39;)    plt.annotate(xy=(x_+.1, y_-.1), text=&#39;c&#39;+str(i), color=clr, size=14)plt.title(&quot;Plot showing influence of recent centroids on data points&quot;, fontsize=14)plt.xlabel(&quot;x1&quot;, fontsize=12)plt.ylabel(&quot;x2&quot;, fontsize=12)plt.show()</code></pre><!-- ![1.4.1](./Kmeans/1.4.1.png) --><img src="/2024/04/24/Kmeans/1.4.1.png" class><ul><li>To do that, we shall calculate the mean of the data points each centroid influences and put the centroid at that mean location.</li><li>If a centroid has no points it influences (yes, this can happen), we leave the centroid where it is.</li></ul><pre><code class="python">centroids_ = []for i in range(k):    if len(X[ypred == i]) == 0:        centroids_.append(centroids[i]) # use old    else:        centroids_.append(np.mean(X[ypred == i], axis=0))centroids_ = np.array(centroids_)centroids_#After the update, we have the following plotplt.figure(figsize=(8, 6))for i, (x_, y_) in enumerate(centroids_):  # with underscore    p = plt.scatter(X[ypred==i][:, 0], X[ypred==i][:, 1], s=2)    clr = mpl.colors.to_rgba(p.get_facecolor()) # get color used by matplotlib    plt.scatter(x_, y_, marker=&#39;x&#39;, c=&#39;k&#39;)    plt.annotate(xy=(x_+.1, y_-.1), text=&#39;c&#39;+str(i), color=clr, size=14)plt.title(&quot;Plot showing mean-centered centroids &quot;, fontsize=14)plt.xlabel(&quot;x1&quot;, fontsize=12)plt.ylabel(&quot;x2&quot;, fontsize=12)plt.show()</code></pre><img src="/2024/04/24/Kmeans/1.4.2.png" class><h2 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h2><ul><li>The mean-centered points may look good, however the data they influence may still be bad</li></ul><h2 id="1-5-Repeat-the-above-steps"><a href="#1-5-Repeat-the-above-steps" class="headerlink" title="1.5 Repeat the above steps"></a>1.5 Repeat the above steps</h2><ul><li>Now we repeat the steps above until the centroids donâ€™t update or move (significantly) anymore. That will be the case when <strong>(centroids_ - centroids)^2</strong> is a low value below a certain threshold. A good threshold has to be as low as possible i.e close to or equal to zero.</li><li>You can run the following code multiple times and observe <strong>shift</strong> value (which is <strong>changes of centroids</strong> ) carefully</li><li>Here, we are using <strong>^2</strong> to make larger shifts&#x2F;updates significant. It doesnâ€™t have to be that way. A norm can also work.</li></ul><pre><code class="python">shift = np.sum((centroids_ - centroids)**2)print(shift)# Below we repeat all the previous steps in one runcentroids = centroids_Xc = np.concatenate([X for c in centroids], axis=1) # duplicate k timescentroidsc = centroids.ravel() # ravel to allow broadcastD = (Xc - centroidsc) # raw diffNorms = np.zeros((N, k)) # distances to each clusterfor i in range(0, k):    m = i*feature_size    Norms[:, i] = np.linalg.norm(D[:, m:m+feature_size], axis=1)# Choose the nearest cluster for every point, and save the result in ypred which is used in next code segment# We can use np.argmin functionypred = np.argmin(Norms, axis=1) # new clusters are mean X along centroids_ = []for i in range(k):    if len(X[ypred == i]) == 0:        centroids_.append(centroids[i]) # use old    else:        centroids_.append(np.mean(X[ypred == i], axis=0))centroids_ = np.array(centroids_)centroids_plt.figure(figsize=(8, 6))for i, (x_, y_) in enumerate(centroids_):  # with underscore    p = plt.scatter(X[ypred==i][:, 0], X[ypred==i][:, 1], s=2)    clr = mpl.colors.to_rgba(p.get_facecolor()) # get color used by matplotlib    plt.scatter(x_, y_, marker=&#39;x&#39;, c=&#39;k&#39;)    plt.annotate(xy=(x_+.1, y_-.1), text=&#39;c&#39;+str(i), color=clr, size=14)plt.title(&quot;Plot showing mean-centered centroids &quot;, fontsize=14)plt.xlabel(&quot;x1&quot;, fontsize=12)plt.ylabel(&quot;x2&quot;, fontsize=12)plt.show()</code></pre><img src="/2024/04/24/Kmeans/1.5.png" class>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shortest Path â…¡</title>
      <link href="/2024/04/17/Shortest-Path-%E2%85%A1/"/>
      <url>/2024/04/17/Shortest-Path-%E2%85%A1/</url>
      
        <content type="html"><![CDATA[<p>In the previous article <a href="https://sheldoncoder1337.github.io/2024/04/17/Shortest-Path-%E2%85%A0/">Shortest-Path-â… </a>, we have already learn how to use Networkx and Pandana <code>shortest_path</code> API to find the shortest path on <a href="https://data.cityofnewyork.us/Transportation/NYC-Taxi-Zones/d3c5-ddgc">New York</a> <a href="https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page">New York Taxi Trip</a> dataset. And after comparing the performance between Dijkstra and Constraction Hierarchy algorithm, we could found that CH have a much better performance than classic Dijkstra algorithm.</p><p>In this blog, letâ€™s try to fix the Carpool problem.</p><h2 id="Location-Statistics-Heat-Map-Visualization"><a href="#Location-Statistics-Heat-Map-Visualization" class="headerlink" title="Location Statistics &amp; Heat Map Visualization"></a>Location Statistics &amp; Heat Map Visualization</h2><pre><code class="python">import pandas as pdimport plotly.express as px# Data with latitude/longitude and valuesdf = pd.read_csv(&#39;https://raw.githubusercontent.com/R-CoderDotCom/data/main/sample_datasets/population_galicia.csv&#39;)fig = px.density_mapbox(df, lat = &#39;latitude&#39;, lon = &#39;longitude&#39;, z = &#39;tot_pob&#39;,                        radius = 7,                        center = dict(lat = 42.83, lon = -8.35),                        zoom = 6,                        mapbox_style = &#39;open-street-map&#39;,                        color_continuous_scale = &#39;rainbow&#39;,                        opacity = 0.5)fig.show()</code></pre><h2 id="Carpool-problem"><a href="#Carpool-problem" class="headerlink" title="Carpool problem"></a>Carpool problem</h2><p>With the rise of taxi-hailing mobile programs (such as uber), a New York cab driver is used to take orders from online platform. Given the initial location of the driver and 2-3 orders (e.g., each order is a 6-tuple, like a record in the NY Taxi data), your task is to find a feasible route to pick up all the orders.</p><p>For instance, the driver is now at location Time Square, he is assigned to pick up three passengers.</p><ul><li>passengerA: JFK_Airport to East_Chelsea</li><li>passengerB: West_Village to East_Chelsea</li><li>passengerC: Battery_Park_City to Queens_Plaza</li></ul><p>One feasible solution is to report the route from</p><ul><li>Time Square -&gt; JFK_Airport -&gt; East_Chelsea -&gt; West_Village -&gt; East_Chelsea -&gt; Battery_Park_City -&gt; Queens_Plaza</li></ul><h3 id="Our-target"><a href="#Our-target" class="headerlink" title="Our target"></a>Our target</h3><ol><li>Write a function to determine the route and the total distance of the route.</li><li>Plot the route on the map.</li></ol><p>Obviously, the feasible solution is far from optimal as East_Chelsea is the common locations of two pessagers. Thereby,  </p><h3 id="Bonus-task"><a href="#Bonus-task" class="headerlink" title="Bonus task"></a>Bonus task</h3><ul><li>Try to find the best route based on the given orders. For the bonus part, please explain your methodology and your mark will be given based on the soundness of your idea, the quality of analysis, and the implementation.</li></ul><pre><code class="python"></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm, find-the-shortest-path </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shortest Path â… </title>
      <link href="/2024/04/17/Shortest-Path-%E2%85%A0/"/>
      <url>/2024/04/17/Shortest-Path-%E2%85%A0/</url>
      
        <content type="html"><![CDATA[<p>In this series, I will introduce some third-party libraries such as osmnx, pandana, geopandas and compare the performance between <strong>NetworkX(Dijkstra)</strong> and <strong>Pandana( Constraction Hierarchy)</strong>. Finally, I will show how to use these libraries to solve a <strong>Carpool(æ‹¼è½¦) problem</strong>. The data set used in this article is from <a href="https://www.openstreetmap.org/">OpenStreetMap</a> - New York City Taxi Trip data set.</p><h2 id="preliminary"><a href="#preliminary" class="headerlink" title="preliminary"></a>preliminary</h2><p>You are highly recommended to use Conda to setup a new virtual environment.</p><pre><code class="bash">conda create -n geospatial python==3.8conda activate geospatialpip install geopandas network osmnet osmnx pandas pandana</code></pre><p>If you received an error like â€œspatialindex_c-64.dll is missingâ€, try to use the following commands to resolve it.</p><pre><code class="bash">pip uninstall rtreepip install rtree</code></pre><pre><code class="python">import warningswarnings.filterwarnings(&#39;ignore&#39;)warnings.simplefilter(&#39;ignore&#39;)import osmnx as oximport numpy as npimport geopandas as gpdimport pandanaimport pandas as pdfrom time import timeimport matplotlib.pyplot as pltfrom IPython.display import display, clear_outputimport networkx as nximport momepy</code></pre><h2 id="Data-Preparation"><a href="#Data-Preparation" class="headerlink" title="Data Preparation"></a>Data Preparation</h2><pre><code class="python">def extract_graph(place=&#39;New York&#39;):    # try Chinese    # G = ox.graph_from_place(&#39;çº½çº¦&#39;, network_type=&#39;drive&#39;)    ox.config(log_console=True, use_cache=True)    G = ox.graph_from_place(place, network_type=&#39;drive&#39;)    return Gplace = &#39;New York&#39;G = extract_graph(place)ox.plot_graph(G, bgcolor=&quot;w&quot;, node_size=1, node_color=&quot;yellow&quot;, edge_color=&quot;#aaa&quot;)print(&quot;node count:&quot;, len(G.nodes()))print(&quot;edge count:&quot;, len(G.edges()))</code></pre><!-- ![New York Taxi Trip](https://github.com/SheldonCoder1337/sheldoncoder1337.github.io/blob/master/2024/04/17/Shortest-Path/New-York-Taxi-Trip.png?raw=true) --><img src="/2024/04/17/Shortest-Path-%E2%85%A0/New-York-Taxi-Trip.png" class><p>There are total node 55344 nodes and 139582 edges.</p><p>We process <a href="https://data.cityofnewyork.us/Transportation/NYC-Taxi-Zones/d3c5-ddgc">New York</a> <a href="https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page">New York Taxi Trip</a>  and provide Trips.txt (<a href="https://github.com/SheldonCoder1337/sheldoncoder1337.github.io/sources/Shortest-Path/Trips.txt">Appendix</a>)</p><p>Trips.txt contains New York Taxi trajectory information for 10,000 lines, each containing six columns of information, the region name where the passengers are picked up(PName),the lon and lat of the region in which they are picked up(PLon PLat),the region name they are delivered(Dname) and in which the passenger is delivered(DLon DLat).</p><p>For example:</p><table><thead><tr><th>PName</th><th>PLon</th><th>PLat</th><th>DName</th><th>DLon</th><th>DLat</th></tr></thead><tbody><tr><td>Lincoln_Square_East</td><td>-73.97382133</td><td>40.73788468</td><td>Upper_East_Side_North</td><td>-73.91715837</td><td>40.8541322</td></tr><tr><td>Upper_East_Side_North</td><td>-73.91715837</td><td>40.8541322</td><td>Central_Harlem_North</td><td>-73.99804922</td><td>40.71156838</td></tr></tbody></table><h2 id="Find-the-Shortest-Path"><a href="#Find-the-Shortest-Path" class="headerlink" title="Find the Shortest Path"></a>Find the Shortest Path</h2><p>There are two ways to find the shortest path, please check the docs for more details:</p><ol><li><a href="https://networkx.org/documentation/stable/reference/algorithms/shortest_paths.html">NetworkX</a></li><li><a href="https://udst.github.io/pandana/">Pandana(CH)</a></li></ol><h3 id="NetworkX-Dijkstra"><a href="#NetworkX-Dijkstra" class="headerlink" title="NetworkX(Dijkstra)"></a>NetworkX(Dijkstra)</h3><pre><code class="python"># The first trip record is from Lincoln_Square_East to Upper_East_Side_Northnx_Lincoln_Square_East_id = ox.distance.nearest_nodes(G,Lincoln_Square_East_Location.x,Lincoln_Square_East_Location.y)[0]nx_Upper_East_Side_North_id = ox.distance.nearest_nodes(G,Upper_East_Side_North_Location.x,Upper_East_Side_North_Location.y)[0]# NetworkX shortest pathdef SP_NX(G,SID,TID):    return nx.shortest_path(G, source=SID, target=TID, method=&quot;dijkstra&quot;, weight=&#39;length&#39;)     #displayNX_PATH=SP_NX(G,nx_Lincoln_Square_East_id,nx_Upper_East_Side_North_id)    fig , ax = ox.plot_graph(G, bgcolor=&quot;w&quot;, node_size=1, node_color=&quot;gray&quot;, edge_color=&quot;#aaa&quot;,show=False,close=False)ax.scatter(-73.97382133,40.73788468,c=&#39;yellow&#39;,marker=&quot;s&quot;,alpha=1,zorder=4)ax.scatter(-73.91715837,40.8541322,c=&#39;blue&#39;,alpha=1,zorder=3)ox.plot_graph_route(G,NX_PATH,ax=ax,orig_dest_size=0,route_alpha=0.5,route_colors=&#39;r&#39;,route_linewidths=2,show=False,close=False)</code></pre><!-- ![shortest path networkx Dijkstra](https://github.com/SheldonCoder1337/sheldoncoder1337.github.io/blob/master/2024/04/17/Shortest-Path/Shortest-Path-NetworkX.png?raw=true) --><img src="/2024/04/17/Shortest-Path-%E2%85%A0/Shortest-Path-NetworkX.png" class><h3 id="Pandana-CH"><a href="#Pandana-CH" class="headerlink" title="Pandana(CH)"></a>Pandana(CH)</h3><pre><code class="python"># trans road network to pandana formatnodes,edges = ox.graph_to_gdfs(G,nodes=True,edges=True)edges = edges.reset_index()G_pan = pandana.Network(nodes[&#39;x&#39;], nodes[&#39;y&#39;], edges[&#39;u&#39;], edges[&#39;v&#39;], edges[[&#39;length&#39;]],twoway=False)# The first trip record is from Lincoln_Square_East to Upper_East_Side_NorthLincoln_Square_East_Location = pd.DataFrame(&#123;&#39;longitude&#39;:[-73.97382133], &#39;latitude&#39;: [40.73788468]&#125;)Lincoln_Square_East_Location = gpd.points_from_xy(Lincoln_Square_East_Location.longitude, Lincoln_Square_East_Location.latitude, crs=&quot;EPSG:4326&quot;)Upper_East_Side_North_Location = pd.DataFrame(&#123;&#39;longitude&#39;:[-73.91715837], &#39;latitude&#39;: [40.8541322]&#125;)Upper_East_Side_North_Location = gpd.points_from_xy(Upper_East_Side_North_Location.longitude, Upper_East_Side_North_Location.latitude, crs=&quot;EPSG:4326&quot;)pan_Lincoln_Square_East_id = G_pan.get_node_ids(Lincoln_Square_East_Location.x,Lincoln_Square_East_Location.y).iloc[0]pan_Upper_East_Side_North_id = G_pan.get_node_ids(Upper_East_Side_North_Location.x,Upper_East_Side_North_Location.y).iloc[0]# pandana shortest pathdef SP_PAN(G_pan,SID,TID):    return G_pan.shortest_path(SID,TID) #displayPAN_PATH=SP_PAN(G_pan,pan_Lincoln_Square_East_id,pan_Upper_East_Side_North_id)    fig , ax = ox.plot_graph(G, bgcolor=&quot;w&quot;, node_size=1, node_color=&quot;gray&quot;, edge_color=&quot;#aaa&quot;,show=False,close=False)ax.scatter(-73.97382133,40.73788468,c=&#39;yellow&#39;,marker=&quot;s&quot;,alpha=1,zorder=4)ax.scatter(-73.91715837,40.8541322,c=&#39;blue&#39;,alpha=1,zorder=3)ox.plot_graph_route(G,PAN_PATH,ax=ax,orig_dest_size=0,route_alpha=0.5,route_colors=&#39;r&#39;,route_linewidths=2,show=False,close=False)</code></pre><!-- ![shortest path pandana CH](https://github.com/SheldonCoder1337/sheldoncoder1337.github.io/blob/master/2024/04/17/Shortest-Path/Shortest-Path-Pandana-CH.png?raw=true) --><img src="/2024/04/17/Shortest-Path-%E2%85%A0/Shortest-Path-Pandana-CH.png" class><h3 id="Comparison"><a href="#Comparison" class="headerlink" title="Comparison"></a>Comparison</h3><pre><code class="python"># you should upload trips.txt to your jupyter notebook first pickup_name=[]pickup_lon=[]pickup_lat=[]disengaged_name=[]disengaged_lon=[]disengaged_lat=[]import csv # opening the CSV filewith open(&#39;trips.txt&#39;, mode =&#39;r&#39;)as file:     # reading the CSV file  csvFile = csv.reader(file)    # displaying the contents of the CSV file  for lines in csvFile:        pickup_name.append(lines[0])        pickup_lon.append(lines[1])        pickup_lat.append(lines[2])        disengaged_name.append(lines[3])        disengaged_lon.append(lines[4])        disengaged_lat.append(lines[5])pickup_info = pd.DataFrame(&#123;&#39;pickup_name&#39;:pickup_name,&#39;longitude&#39;:pickup_lon, &#39;latitude&#39;: pickup_lat&#125;)disengaged_info = pd.DataFrame(&#123;&#39;disengaged_name&#39;:disengaged_name,&#39;longitude&#39;:disengaged_lon, &#39;latitude&#39;: disengaged_lat&#125;)pickup_Location = gpd.points_from_xy(pickup_info.longitude, pickup_info.latitude, crs=&quot;EPSG:4326&quot;)disengaged_Location = gpd.points_from_xy(disengaged_info.longitude, disengaged_info.latitude, crs=&quot;EPSG:4326&quot;)pickup_id = G_pan.get_node_ids(pickup_Location.x,pickup_Location.y)disengaged_id = G_pan.get_node_ids(disengaged_Location.x,disengaged_Location.y)nx_pickup_id = list(ox.distance.nearest_nodes(G,pickup_Location.x,pickup_Location.y))nx_disengaged_id = list(ox.distance.nearest_nodes(G,disengaged_Location.x,disengaged_Location.y))time_PAN=[]time_NX=[]test=[1,5,10,50,100,200,300,500,1000] # the query sizeNX_BATCH_PATH=[]PAN_BATCH_PATH=[]# This is the loop for evaluating the time of NetworkXfor i in range(len(test)):        tik = time()    for j in range(test[i]):         NX_BATCH_PATH.append(nx.shortest_path(G,source=nx_pickup_id[j],target=nx_disengaged_id[j],method=&#39;dijkstra&#39;,weight=&#39;length&#39;))        tok = time()    time_NX.append(tok-tik)    print(&#39;when query size = &#39;,test[i],end=&#39; , &#39;)    print(&#39;Time of Networkx is : &#39;,time_NX[-1],end=&#39;s\n&#39;)# This is the loop for evaluating the time of Pandanafor i in range(len(test)):    tik = time()    for j in range(test[i]):        PAN_BATCH_PATH.append(G_pan.shortest_path(pickup_id[j],disengaged_id[j]))        tok = time()    time_PAN.append(tok-tik)    print(&#39;when query size = &#39;,test[i],end=&#39; , &#39;)    print(&#39;Time of Pandana is : &#39;,time_PAN[-1],end=&#39;s\n&#39;)fig = plt.figure()ax = fig.add_subplot(1, 1, 1) clear_output(wait = True)ax.plot(test,time_PAN,label=&#39;Panadana&#39;)ax.plot(test,time_NX,label=&#39;Networkx&#39;)plt.ylabel(&#39;computing time(s)&#39;)plt.xlabel(&#39;Number of Query&#39;)plt.legend()fig.show()</code></pre><!-- ![shortest path comparison](https://github.com/SheldonCoder1337/sheldoncoder1337.github.io/blob/master/2024/04/17/Shortest-Path/shortest-path-comparison.png?raw=true) --><img src="/2024/04/17/Shortest-Path-%E2%85%A0/shortest-path-comparison.png" class><p>Here, we use Batch evaluation between Dijkstra (NetworkX) and CH (Pandana), and the results shows that CH algor is much faster than classical Dijskra.</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm, find-the-shortest-path </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo hand book</title>
      <link href="/2024/04/16/hexo-hand-book/"/>
      <url>/2024/04/16/hexo-hand-book/</url>
      
        <content type="html"><![CDATA[<h2 id="å‘å¸ƒæ–‡ç« "><a href="#å‘å¸ƒæ–‡ç« " class="headerlink" title="å‘å¸ƒæ–‡ç« "></a>å‘å¸ƒæ–‡ç« </h2><p>è¿›å…¥åšå®¢æ‰€åœ¨ç›®å½•ï¼Œå³é”®æ‰“å¼€Git Bash Hereï¼Œåˆ›å»ºåšæ–‡ï¼š</p><pre><code class="bash">hexo new &quot;article title&quot;</code></pre><p>ç„¶å source æ–‡ä»¶å¤¹ä¸­ä¼šå‡ºç°ä¸€ä¸ª My New Post.md æ–‡ä»¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ Markdown ç¼–è¾‘å™¨åœ¨è¯¥æ–‡ä»¶ä¸­æ’°å†™æ–‡ç« äº†ã€‚</p><p>å†™å®Œåè¿è¡Œä¸‹é¢ä»£ç å°†æ–‡ç« æ¸²æŸ“å¹¶éƒ¨ç½²åˆ° GitHub Pages ä¸Šå®Œæˆå‘å¸ƒã€‚ä»¥åæ¯æ¬¡å‘å¸ƒæ–‡ç« éƒ½æ˜¯è¿™ä¸¤æ¡å‘½ä»¤ã€‚</p><pre><code class="bash">hexo g   # ç”Ÿæˆé¡µé¢hexo d   # éƒ¨ç½²å‘å¸ƒ</code></pre><p>ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨å‘½ä»¤è‡ªå·±åˆ›å»º .md æ–‡ä»¶ï¼Œåªéœ€åœ¨æ–‡ä»¶å¼€å¤´æ‰‹åŠ¨åŠ å…¥å¦‚ä¸‹æ ¼å¼ Front-matter å³å¯ï¼Œå†™å®Œåè¿è¡Œ hexo g å’Œ hexo d å‘å¸ƒã€‚</p><pre><code class="markdown">---title: Hello World # æ ‡é¢˜date: 2019/3/26 hh:mm:ss # æ—¶é—´categories: # åˆ†ç±»- Diarytags: # æ ‡ç­¾- PS3- Games---æ‘˜è¦&lt;!--more--&gt;æ­£æ–‡</code></pre><h2 id="ç½‘ç«™è®¾ç½®"><a href="#ç½‘ç«™è®¾ç½®" class="headerlink" title="ç½‘ç«™è®¾ç½®"></a>ç½‘ç«™è®¾ç½®</h2><p>åŒ…æ‹¬ç½‘ç«™åç§°ã€æè¿°ã€ä½œè€…ã€é“¾æ¥æ ·å¼ç­‰ï¼Œå…¨éƒ¨åœ¨ç½‘ç«™ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ä¸­ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£æŒ‰éœ€è¦ç¼–è¾‘ã€‚</p><p>æ³¨æ„ï¼šå†’å·åè¦åŠ ä¸€ä¸ªç©ºæ ¼ï¼</p><h2 id="æ›´æ¢ä¸»é¢˜"><a href="#æ›´æ¢ä¸»é¢˜" class="headerlink" title="æ›´æ¢ä¸»é¢˜"></a>æ›´æ¢ä¸»é¢˜</h2><p>åœ¨ Themes | Hexo é€‰æ‹©ä¸€ä¸ªå–œæ¬¢çš„ä¸»é¢˜ï¼Œæ¯”å¦‚ NexTï¼Œè¿›å…¥ç½‘ç«™ç›®å½•æ‰“å¼€ Git Bash Here ä¸‹è½½ä¸»é¢˜ï¼š</p><pre><code class="bash">git clone https://github.com/iissnan/hexo-theme-next themes/next</code></pre><p>ç„¶åä¿®æ”¹ _config.yml ä¸­çš„ theme ä¸ºæ–°ä¸»é¢˜åç§° nextï¼Œå‘å¸ƒã€‚ï¼ˆæœ‰çš„ä¸»é¢˜éœ€è¦å°† _config.yml æ›¿æ¢ä¸ºä¸»é¢˜è‡ªå¸¦çš„ï¼Œå‚è€ƒä¸»é¢˜è¯´æ˜ã€‚ï¼‰</p><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><pre><code class="bash">hexo new &quot;name&quot;       # æ–°å»ºæ–‡ç« hexo new page &quot;name&quot;  # æ–°å»ºé¡µé¢hexo g                # ç”Ÿæˆé¡µé¢hexo d                # éƒ¨ç½²hexo g -d             # ç”Ÿæˆé¡µé¢å¹¶éƒ¨ç½²hexo s                # æœ¬åœ°é¢„è§ˆhexo clean            # æ¸…é™¤ç¼“å­˜å’Œå·²ç”Ÿæˆçš„é™æ€æ–‡ä»¶hexo help             # å¸®åŠ©</code></pre><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><p>1ã€Hexo è®¾ç½®æ˜¾ç¤ºæ–‡ç« æ‘˜è¦ï¼Œé¦–é¡µä¸æ˜¾ç¤ºå…¨æ–‡</p><p>Hexo ä¸»é¡µæ–‡ç« åˆ—è¡¨é»˜è®¤ä¼šæ˜¾ç¤ºæ–‡ç« å…¨æ–‡ï¼Œæµè§ˆæ—¶å¾ˆä¸æ–¹ä¾¿ï¼Œå¯ä»¥åœ¨æ–‡ç« ä¸­æ’å…¥</p><pre><code class="markdown">&lt;!--more--&gt;</code></pre><p>è¿›è¡Œåˆ†æ®µã€‚</p><p>è¯¥ä»£ç å‰é¢çš„å†…å®¹ä¼šä½œä¸ºæ‘˜è¦æ˜¾ç¤ºï¼Œè€Œåé¢çš„å†…å®¹ä¼šæ›¿æ¢ä¸º â€œRead Moreâ€ éšè—èµ·æ¥ã€‚</p><p>2ã€è®¾ç½®ç½‘ç«™å›¾æ ‡</p><p>è¿›å…¥ themes&#x2F;ä¸»é¢˜ æ–‡ä»¶å¤¹ï¼Œæ‰“å¼€ _config.yml é…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ° favicon ä¿®æ”¹ï¼Œä¸€èˆ¬æ ¼å¼ä¸ºï¼šfavicon: å›¾æ ‡åœ°å€ã€‚ï¼ˆä¸åŒä¸»é¢˜å¯èƒ½ç•¥æœ‰å·®åˆ«ï¼‰</p><p>3ã€ä¿®æ”¹å¹¶éƒ¨ç½²åæ²¡æœ‰æ•ˆæœ</p><p>ä½¿ç”¨ hexo clean æ¸…ç†åé‡æ–°éƒ¨ç½²ã€‚</p><p>4ã€markdownå›¾ç‰‡å¼•å…¥æ²¡æœ‰æ•ˆæœ</p><ul><li>ç»Ÿä¸€æ”¹ä¸ºGithubä»“åº“å›¾ç‰‡é“¾æ¥ï¼Œä¾‹å­ï¼š</li></ul><pre><code class="markdwon">![&quot;å›¾ç‰‡æ ‡é¢˜&quot;](https://github.com/SheldonCoder1337/sheldoncoder1337.github.io/blob/master/2024/04/17/temp/sheldon.png?raw=true)</code></pre><ul><li>ä½¿ç”¨æ¨¡æ¿è¯­è¨€</li></ul><pre><code class="markdown">&#123;% asset_img sheldon.png "å›¾ç‰‡æ ‡é¢˜" %&#125;</code></pre><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>Hexo æ˜¯ä¸€ç§çº¯é™æ€çš„åšå®¢ï¼Œæˆ‘ä»¬å¿…é¡»è¦åœ¨æœ¬åœ°å®Œæˆæ–‡ç« çš„ç¼–è¾‘å†éƒ¨ç½²åˆ° GitHub ä¸Šï¼Œä¾èµ–äºæœ¬åœ°ç¯å¢ƒã€‚ä¸èƒ½åƒ WordPress æˆ– Typecho é‚£æ ·çš„åŠ¨æ€åšå®¢ä¸€æ ·èƒ½ç›´æ¥åœ¨æµè§ˆå™¨ä¸­å®Œæˆæ’°æ–‡å’Œå‘å¸ƒã€‚</p><p>å¯ä»¥è¯´æ˜¯ä¸€ç§æ¯”è¾ƒæå®¢çš„å†™åšå®¢æ–¹å¼ï¼Œä½†æ˜¯ä¼˜åŠ¿ä¹Ÿæ˜¯æ˜æ˜¾çš„â€”â€”å…è´¹ç¨³å®šçœå¿ƒï¼Œæ¯”è¾ƒé€‚åˆçˆ±æŠ˜è…¾ç ”ç©¶çš„ç”¨æˆ·ï¼Œæˆ–è€…æ²¡æœ‰åœ¨çº¿å‘æ–‡éœ€æ±‚çš„æœ‹å‹ã€‚</p><p><a href="https://hexo.io/">Hexo</a>!  Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
